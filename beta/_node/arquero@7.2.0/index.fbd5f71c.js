import{parse as wr}from"../acorn@8.14.0/index.80ce3267.js";import{tableFromColumns as xr,columnFromArray as br,columnFromValues as Mr,tableToIPC as Er,tableFromIPC as jr}from"../@uwdata/flechette@1.1.1/index.0ec36e66.js";let Bt=class{constructor(e){this._size=e,this._bits=new Uint32Array(Math.ceil(e/32))}get length(){return this._size}count(){const e=this._bits.length;let n=0;for(let r=0;r<e;++r)for(let s=this._bits[r];s;++n)s&=s-1;return n}get(e){return this._bits[e>>5]&2147483648>>>e}set(e){this._bits[e>>5]|=2147483648>>>e}clear(e){this._bits[e>>5]&=~(2147483648>>>e)}scan(e){for(let n=this.next(0);n>=0;n=this.next(n+1))e(n)}next(e){const n=this._bits,r=n.length;let s=e>>5,a=n[s]&4294967295>>>e;for(;s<r;a=n[++s])if(a!==0)return(s<<5)+Math.clz32(a);return-1}nth(e){let n=this.next(0);for(;e--&&n>=0;)n=this.next(n+1);return n}not(){const e=this._bits,n=e.length;for(let s=0;s<n;++s)e[s]=~e[s];const r=this._size%32;return r&&(e[n-1]&=2147483648>>r-1),this}and(e){if(e){const n=this._bits,r=e._bits,s=n.length;for(let a=0;a<s;++a)n[a]&=r[a]}return this}or(e){if(e){const n=this._bits,r=e._bits,s=n.length;for(let a=0;a<s;++a)n[a]|=r[a]}return this}};var w=void 0,D=Array.isArray;const kr=Object.getPrototypeOf(Int8Array);function St(t){return t instanceof kr}function K(t){return D(t)||St(t)}function R(t){return typeof t=="string"}function L(t){return t!=null&&t===t}const gt=t=>K(t)||R(t);var Ar={compact:t=>K(t)?t.filter(e=>L(e)):t,concat:(...t)=>[].concat(...t),includes:(t,e,n)=>gt(t)?t.includes(e,n):!1,indexof:(t,e)=>gt(t)?t.indexOf(e):-1,join:(t,e)=>K(t)?t.join(e):w,lastindexof:(t,e)=>gt(t)?t.lastIndexOf(e):-1,length:t=>gt(t)?t.length:0,pluck:(t,e)=>K(t)?t.map(n=>L(n)?n[e]:w):w,reverse:t=>K(t)?t.slice().reverse():R(t)?t.split("").reverse().join(""):w,slice:(t,e,n)=>gt(t)?t.slice(e,n):w};function Nr(t,e,n,r,s){return t==null?null:t<e?-1/0:t>n?1/0:(t=Math.max(e,Math.min(t,n)),e+r*Math.floor(1e-14+(t-e)/r+(s||0)))}function Ot(t,e,n="0"){const r=t+"",s=r.length;return s<e?Array(e-s+1).join(n)+r:r}const W=t=>(t<10?"0":"")+t,Sr=t=>t<0?"-"+Ot(-t,6):t>9999?"+"+Ot(t,6):Ot(t,4);function Fe(t,e,n,r,s,a,i,o,u){const l=o?"Z":"";return Sr(t)+"-"+W(e+1)+"-"+W(n)+(!u||i?"T"+W(r)+":"+W(s)+":"+W(a)+"."+Ot(i,3)+l:a?"T"+W(r)+":"+W(s)+":"+W(a)+l:s||r||!o?"T"+W(r)+":"+W(s)+l:"")}function Te(t,e){return isNaN(t)?"Invalid Date":Fe(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),!1,e)}function Ct(t,e){return isNaN(t)?"Invalid Date":Fe(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds(),!0,e)}const Or=/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/;function Yt(t){return t.match(Or)&&!isNaN(Date.parse(t))}function Cr(t,e=Date.parse){return Yt(t)?e(t):t}const Ue=6e4,De=864e5,Re=6048e5,A=new Date,N=new Date,S=t=>(A.setTime(typeof t=="string"?Cr(t):t),A);function Fr(t,e,n,r,s,a,i){return arguments.length?new Date(t,e||0,n??1,r||0,s||0,a||0,i||0):new Date(Date.now())}function Tr(t,e,n,r,s,a,i){return arguments.length?new Date(Date.UTC(t,e||0,n??1,r||0,s||0,a||0,i||0)):new Date(Date.now())}function Ur(t){N.setTime(+t),N.setHours(0,0,0,0),A.setTime(+N),A.setMonth(0),A.setDate(1);const e=(N.getTimezoneOffset()-A.getTimezoneOffset())*Ue;return Math.floor(1+(+N-+A-e)/De)}function Dr(t){N.setTime(+t),N.setUTCHours(0,0,0,0);const e=Date.UTC(N.getUTCFullYear(),0,1);return Math.floor(1+(+N-e)/De)}function Rr(t,e){const n=e||0;N.setTime(+t),N.setDate(N.getDate()-(N.getDay()+7-n)%7),N.setHours(0,0,0,0),A.setTime(+t),A.setMonth(0),A.setDate(1),A.setDate(1-(A.getDay()+7-n)%7),A.setHours(0,0,0,0);const r=(N.getTimezoneOffset()-A.getTimezoneOffset())*Ue;return Math.floor((1+(+N-+A)-r)/Re)}function zr(t,e){const n=e||0;return N.setTime(+t),N.setUTCDate(N.getUTCDate()-(N.getUTCDay()+7-n)%7),N.setUTCHours(0,0,0,0),A.setTime(+t),A.setUTCMonth(0),A.setUTCDate(1),A.setUTCDate(1-(A.getUTCDay()+7-n)%7),A.setUTCHours(0,0,0,0),Math.floor((1+(+N-+A))/Re)}var Ir={format_date:(t,e)=>Te(S(t),!e),format_utcdate:(t,e)=>Ct(S(t),!e),now:Date.now,timestamp:t=>+S(t),datetime:Fr,year:t=>S(t).getFullYear(),quarter:t=>Math.floor(S(t).getMonth()/3),month:t=>S(t).getMonth(),week:Rr,date:t=>S(t).getDate(),dayofyear:Ur,dayofweek:t=>S(t).getDay(),hours:t=>S(t).getHours(),minutes:t=>S(t).getMinutes(),seconds:t=>S(t).getSeconds(),milliseconds:t=>S(t).getMilliseconds(),utcdatetime:Tr,utcyear:t=>S(t).getUTCFullYear(),utcquarter:t=>Math.floor(S(t).getUTCMonth()/3),utcmonth:t=>S(t).getUTCMonth(),utcweek:zr,utcdate:t=>S(t).getUTCDate(),utcdayofyear:Dr,utcdayofweek:t=>S(t).getUTCDay(),utchours:t=>S(t).getUTCHours(),utcminutes:t=>S(t).getUTCMinutes(),utcseconds:t=>S(t).getUTCSeconds(),utcmilliseconds:t=>S(t).getUTCMilliseconds()};function nt(t){return t instanceof Date}function Ft(t){return t instanceof RegExp}function tt(t){return t===Object(t)}function Qt(t,e){return t==null||e==null||t!==t||e!==e?!1:t===e?!0:nt(t)||nt(e)?+t==+e:Ft(t)&&Ft(e)?t+""==e+"":tt(t)&&tt(e)?qr(t,e):!1}function qr(t,e){if(Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;if(t.length||e.length)return ze(t,e);const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length||(n.sort(),r.sort(),!ze(n,r,(a,i)=>a===i)))return!1;const s=n.length;for(let a=0;a<s;++a){const i=n[a];if(!Qt(t[i],e[i]))return!1}return!0}function ze(t,e,n=Qt){const r=t.length;if(r!==e.length)return!1;for(let s=0;s<r;++s)if(!n(t[s],e[s]))return!1;return!0}var Pr={parse_json:t=>JSON.parse(t),to_json:t=>JSON.stringify(t)};let Ie=Math.random;function ct(){return Ie()}function Lr(t){Ie=L(t)&&isFinite(t=+t)?Vr(t):Math.random}function Vr(t){const e=23283064365386963e-26;return t=(0<=t&&t<1?t/e:Math.abs(t))|0,()=>(t=1664525*t+1013904223|0,e*(t>>>0))}var Jr={random:ct,is_nan:Number.isNaN,is_finite:Number.isFinite,abs:Math.abs,cbrt:Math.cbrt,ceil:Math.ceil,clz32:Math.clz32,exp:Math.exp,expm1:Math.expm1,floor:Math.floor,fround:Math.fround,greatest:Math.max,least:Math.min,log:Math.log,log10:Math.log10,log1p:Math.log1p,log2:Math.log2,pow:Math.pow,round:Math.round,sign:Math.sign,sqrt:Math.sqrt,trunc:Math.trunc,degrees:t=>180*t/Math.PI,radians:t=>Math.PI*t/180,acos:Math.acos,acosh:Math.acosh,asin:Math.asin,asinh:Math.asinh,atan:Math.atan,atan2:Math.atan2,atanh:Math.atanh,cos:Math.cos,cosh:Math.cosh,sin:Math.sin,sinh:Math.sinh,tan:Math.tan,tanh:Math.tanh},V=Object.hasOwn;function Zt(t){return t instanceof Map}function Gr(t){return t instanceof Set}function Tt(t){return Zt(t)||Gr(t)}function Xt(t){return Array.from(t)}var Hr={has:(t,e)=>Tt(t)?t.has(e):t!=null?V(t,`${e}`):!1,keys:t=>Zt(t)?Xt(t.keys()):t!=null?Object.keys(t):[],values:t=>Tt(t)?Xt(t.values()):t!=null?Object.values(t):[],entries:t=>Tt(t)?Xt(t.entries()):t!=null?Object.entries(t):[],object:t=>t?Object.fromEntries(t):w};function Wr(t,e,n){if(e instanceof Map){if(e.has(t))return e.get(t)}else{const r=`${t}`;if(V(e,r))return e[r]}return n!==void 0?n:t}function qe(t,e,n){let r=arguments.length;t=+t,e=+e,n=r<2?(e=t,t=0,1):r<3?1:+n,r=Math.max(0,Math.ceil((e-t)/n))|0;const s=new Array(r);for(let a=0;a<r;++a)s[a]=t+a*n;return s}var Br={parse_date:t=>t==null?t:new Date(t),parse_float:t=>t==null?t:Number.parseFloat(t),parse_int:(t,e)=>t==null?t:Number.parseInt(t,e),endswith:(t,e,n)=>t==null?!1:String(t).endsWith(e,n),match:(t,e,n)=>{const r=t==null?t:String(t).match(e);return n==null||r==null?r:typeof n=="number"?r[n]:r.groups?r.groups[n]:null},normalize:(t,e)=>t==null?t:String(t).normalize(e),padend:(t,e,n)=>t==null?t:String(t).padEnd(e,n),padstart:(t,e,n)=>t==null?t:String(t).padStart(e,n),upper:t=>t==null?t:String(t).toUpperCase(),lower:t=>t==null?t:String(t).toLowerCase(),repeat:(t,e)=>t==null?t:String(t).repeat(e),replace:(t,e,n)=>t==null?t:String(t).replace(e,String(n)),split:(t,e,n)=>t==null?[]:String(t).split(e,n),startswith:(t,e,n)=>t==null?!1:String(t).startsWith(e,n),substring:(t,e,n)=>t==null?t:String(t).substring(e,n),trim:t=>t==null?t:String(t).trim()},rt={bin:Nr,equal:Qt,recode:Wr,sequence:qe,...Ar,...Ir,...Pr,...Jr,...Hr,...Br};function B(t){return t!=null?D(t)?t:[t]:[]}function $t(t){return typeof t=="bigint"}function J(t){return t===void 0?t+"":$t(t)?t+"n":JSON.stringify(t)}let Yr=class{constructor(e,n,r){this.name=e,this.fields=n,this.params=r}toString(){const e=[...this.fields.map(n=>`d[${J(n)}]`),...this.params.map(J)];return`d => op.${this.name}(${e})`}toObject(){return{expr:this.toString(),func:!0}}};function v(t,e=[],n=[]){return new Yr(t,B(e),B(n))}const Pe=t=>v("any",t),Le=()=>v("count"),Ve=t=>v("array_agg",t),Je=t=>v("array_agg_distinct",t),Ge=(t,e)=>v("map_agg",[t,e]),He=(t,e)=>v("object_agg",[t,e]),We=(t,e)=>v("entries_agg",[t,e]);var Ut={...rt,row_object:(...t)=>v("row_object",null,t.flat()),count:Le,any:Pe,array_agg:Ve,array_agg_distinct:Je,object_agg:He,map_agg:Ge,entries_agg:We,valid:t=>v("valid",t),invalid:t=>v("invalid",t),distinct:t=>v("distinct",t),mode:t=>v("mode",t),sum:t=>v("sum",t),product:t=>v("product",t),mean:t=>v("mean",t),average:t=>v("average",t),variance:t=>v("variance",t),variancep:t=>v("variancep",t),stdev:t=>v("stdev",t),stdevp:t=>v("stdevp",t),min:t=>v("min",t),max:t=>v("max",t),quantile:(t,e)=>v("quantile",t,e),median:t=>v("median",t),covariance:(t,e)=>v("covariance",[t,e]),covariancep:(t,e)=>v("covariancep",[t,e]),corr:(t,e)=>v("corr",[t,e]),bins:(t,e,n,r,s)=>v("bins",t,[e,n,r,s]),row_number:()=>v("row_number"),rank:()=>v("rank"),avg_rank:()=>v("avg_rank"),dense_rank:()=>v("dense_rank"),percent_rank:()=>v("percent_rank"),cume_dist:()=>v("cume_dist"),ntile:t=>v("ntile",null,t),lag:(t,e,n)=>v("lag",t,[e,n]),lead:(t,e,n)=>v("lead",t,[e,n]),first_value:t=>v("first_value",t),last_value:t=>v("last_value",t),nth_value:(t,e)=>v("nth_value",t,e),fill_down:(t,e)=>v("fill_down",t,e),fill_up:(t,e)=>v("fill_up",t,e)};function M(t,e){throw Error(t,{cause:e})}function Qr(t,e){t=Tt(t)?t:new Set(t);let n=e,r=0;for(;t.has(n);)n=e+ ++r;return n}let Be=class{constructor(e){this._outputs=e}size(){return this._outputs.length}outputs(){return this._outputs}init(e){return{}}add(e,n,r){}rem(e,n,r){}write(e,n,r){}};function Zr(t,e,n=15,r=!0,s=0,a){const i=Math.LN10;if(a==null){const o=Math.ceil(Math.log(n)/i),u=e-t||Math.abs(t)||1,l=[5,2];for(a=Math.max(s,Math.pow(10,Math.round(Math.log(u)/i)-o));Math.ceil(u/a)>n;)a*=10;const c=l.length;for(let d=0;d<c;++d){const f=a/l[d];f>=s&&u/f<=n&&(a=f)}}if(r){let o=Math.log(a);const u=o>=0?0:~~(-o/i)+1,l=Math.pow(10,-u-1);o=Math.floor(t/a+l)*a,t=t<o?o-a:o,e=Math.ceil(e/a)*a}return[t,e===t?t+a:e,a]}function ft(t){const e=typeof t;return e==="string"?`"${t}"`:e!=="object"||!t?t:nt(t)?+t:D(t)||St(t)?`[${t.map(ft)}]`:Ft(t)?t+"":Xr(t)}function Xr(t){let e="{",n=-1;for(const r in t)++n>0&&(e+=","),e+=`"${r}":${ft(t[r])}`;return e+="}",e}function Dt(t,e){const n=t.length;return n===1?(r,s)=>ft(t[0](r,s)):(r,s)=>{let a="";for(let i=0;i<n;++i){i>0&&(a+="|");const o=t[i](r,s);if(e&&(o==null||o!==o))return null;a+=ft(o)}return a}}function Kr(){const t=new Map;return{count(){return t.size},values(){return Array.from(t.values(),e=>e.v)},increment(e){const n=ft(e),r=t.get(n);r?++r.n:t.set(n,{v:e,n:1})},decrement(e){const n=ft(e),r=t.get(n);r.n===1?t.delete(n):--r.n},forEach(e){t.forEach(({v:n,n:r})=>e(n,r))}}}function et(){}function ts(t,e=0,n=t.length){let r=t[e++];for(let s=e;s<n;++s)r*=t[s];return r}function O(t){return t.init=t.init||et,t.add=t.add||et,t.rem=t.rem||et,t}function Ye(t,e){return t.product_v=!1,t.product=e}var Kt={count:{create:()=>O({value:t=>t.count}),param:[]},array_agg:{create:()=>O({init:t=>t.values=!0,value:t=>t.list.values(t.stream)}),param:[1]},object_agg:{create:()=>O({init:t=>t.values=!0,value:t=>Object.fromEntries(t.list.values())}),param:[2]},map_agg:{create:()=>O({init:t=>t.values=!0,value:t=>new Map(t.list.values())}),param:[2]},entries_agg:{create:()=>O({init:t=>t.values=!0,value:t=>t.list.values(t.stream)}),param:[2]},any:{create:()=>O({add:(t,e)=>{t.any==null&&(t.any=e)},value:t=>t.valid?t.any:w}),param:[1]},valid:{create:()=>O({value:t=>t.valid}),param:[1]},invalid:{create:()=>O({value:t=>t.count-t.valid}),param:[1]},distinct:{create:()=>({init:t=>t.distinct=Kr(),value:t=>t.distinct.count()+(t.valid===t.count?0:1),add:(t,e)=>t.distinct.increment(e),rem:(t,e)=>t.distinct.decrement(e)}),param:[1]},array_agg_distinct:{create:()=>O({value:t=>t.distinct.values()}),param:[1],req:["distinct"]},mode:{create:()=>O({value:t=>{let e=w,n=0;return t.distinct.forEach((r,s)=>{s>n&&(n=s,e=r)}),e}}),param:[1],req:["distinct"]},sum:{create:()=>({init:t=>t.sum=0,value:t=>t.valid?t.sum:w,add:(t,e)=>$t(e)?t.sum===0?t.sum=e:t.sum+=e:t.sum+=+e,rem:(t,e)=>t.sum-=e}),param:[1]},product:{create:()=>({init:t=>Ye(t,1),value:t=>t.valid?t.product_v?Ye(t,ts(t.list.values())):t.product:void 0,add:(t,e)=>$t(e)&&t.product===1?t.product=e:t.product*=e,rem:(t,e)=>e==0||e===1/0||e===-1/0?t.product_v=!0:t.product/=e}),param:[1],stream:["array_agg"]},mean:{create:()=>({init:t=>t.mean=0,value:t=>t.valid?t.mean:w,add:(t,e)=>{t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid},rem:(t,e)=>{t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean}}),param:[1]},average:{create:()=>O({value:t=>t.valid?t.mean:w}),param:[1],req:["mean"]},variance:{create:()=>({init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):w,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean)}),param:[1],req:["mean"]},variancep:{create:()=>O({value:t=>t.valid>1?t.dev/t.valid:w}),param:[1],req:["variance"]},stdev:{create:()=>O({value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):w}),param:[1],req:["variance"]},stdevp:{create:()=>O({value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):w}),param:[1],req:["variance"]},min:{create:()=>({init:t=>t.min=w,value:t=>t.min=Number.isNaN(t.min)?t.list.min():t.min,add:(t,e)=>{(e<t.min||t.min===w)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)}}),param:[1],stream:["array_agg"]},max:{create:()=>({init:t=>t.max=w,value:t=>t.max=Number.isNaN(t.max)?t.list.max():t.max,add:(t,e)=>{(e>t.max||t.max===w)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)}}),param:[1],stream:["array_agg"]},quantile:{create:t=>O({value:e=>e.list.quantile(t)}),param:[1,1],req:["array_agg"]},median:{create:()=>O({value:t=>t.list.quantile(.5)}),param:[1],req:["array_agg"]},covariance:{create:()=>({init:t=>{t.cov=t.mean_x=t.mean_y=t.dev_x=t.dev_y=0},value:t=>t.valid>1?t.cov/(t.valid-1):w,add:(t,e,n)=>{const r=e-t.mean_x,s=n-t.mean_y;t.mean_x+=r/t.valid,t.mean_y+=s/t.valid;const a=n-t.mean_y;t.dev_x+=r*(e-t.mean_x),t.dev_y+=s*a,t.cov+=r*a},rem:(t,e,n)=>{const r=e-t.mean_x,s=n-t.mean_y;t.mean_x-=t.valid?r/t.valid:t.mean_x,t.mean_y-=t.valid?s/t.valid:t.mean_y;const a=n-t.mean_y;t.dev_x-=r*(e-t.mean_x),t.dev_y-=s*a,t.cov-=r*a}}),param:[2]},covariancep:{create:()=>O({value:t=>t.valid>1?t.cov/t.valid:w}),param:[2],req:["covariance"]},corr:{create:()=>O({value:t=>t.valid>1?t.cov/(Math.sqrt(t.dev_x)*Math.sqrt(t.dev_y)):w}),param:[2],req:["covariance"]},bins:{create:(t,e,n,r)=>O({value:s=>Zr(s.min,s.max,t,e,n,r)}),param:[1,4],req:["min","max"]}};const Qe={create(){let t;return{init:()=>t=1,value:e=>{const n=e.index;return n&&!e.peer(n)?t=n+1:t}}},param:[]},Ze={create(){let t;return{init:()=>t=0,value:e=>{const{index:n,peer:r,size:s}=e;let a=n;if(t<a){for(;a+1<s&&r(a+1);)++a;t=a}return(1+t)/s}}},param:[]};var te={row_number:{create(){return{init:et,value:t=>t.index+1}},param:[]},rank:Qe,avg_rank:{create(){let t,e;return{init:()=>(t=-1,e=1),value:n=>{const r=n.index;if(r>=t){for(e=t=r+1;n.peer(t);e+=++t);e/=t-r}return e}}},param:[]},dense_rank:{create(){let t;return{init:()=>t=1,value:e=>{const n=e.index;return n&&!e.peer(n)?++t:t}}},param:[]},percent_rank:{create(){const{init:t,value:e}=Qe.create();return{init:t,value:n=>(e(n)-1)/(n.size-1)}},param:[]},cume_dist:Ze,ntile:{create(t){t=+t,t>0||M("ntile num must be greater than zero.");const{init:e,value:n}=Ze.create();return{init:e,value:r=>Math.ceil(t*n(r))}},param:[0,1]},lag:{create(t,e=w){return t=+t||1,{init:et,value:(n,r)=>{const s=n.index-t;return s>=0?n.value(s,r):e}}},param:[1,2]},lead:{create(t,e=w){return t=+t||1,{init:et,value:(n,r)=>{const s=n.index+t;return s<n.size?n.value(s,r):e}}},param:[1,2]},first_value:{create(){return{init:et,value:(t,e)=>t.value(t.i0,e)}},param:[1]},last_value:{create(){return{init:et,value:(t,e)=>t.value(t.i1-1,e)}},param:[1]},nth_value:{create(t){return t=+t,t>0||M("nth_value nth must be greater than zero."),{init:et,value:(e,n)=>{const r=e.i0+(t-1);return r<e.i1?e.value(r,n):w}}},param:[1,1]},fill_down:{create(t=w){let e;return{init:()=>e=t,value:(n,r)=>{const s=n.value(n.index,r);return L(s)?e=s:e}}},param:[1,1]},fill_up:{create(t=w){let e,n;return{init:()=>(e=t,n=-1),value:(r,s)=>r.index<=n?e:(n=es(r,s,r.index))>=0?e=r.value(n,s):(n=r.size,e=t)}},param:[1,1]}};function es(t,e,n){for(const r=t.size;n<r;++n)if(L(t.value(n,e)))return n;return-1}function ee(t){return V(Kt,t)}function ne(t){return V(te,t)}function Xe(t){return V(rt,t)||t==="row_object"}function Ke(t){return ee(t)&&Kt[t]}function tn(t){return ne(t)&&te[t]}function vt(t,e=(r,s)=>r,n=""){const r=t.length;if(!r)return"";let s=e(t[0],0);for(let a=1;a<r;++a)s+=n+e(t[a],a);return s}function dt(t,e,...n){const r=["_","$"],s=r.slice(0,n.length);return s.push('"use strict"; const '+n.map((a,i)=>a.map((o,u)=>`${r[i]}${u} = ${r[i]}[${u}]`).join(", ")).join(", ")+`; return (${t}) => ${e};`),Function(...s)(...n)}function re(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function ns(t,e=0,n=t.length){let r=n?t[e++]:w;for(let s=e;s<n;++s)r<t[s]&&(r=t[s]);return r}function rs(t,e=0,n=t.length){let r=n?t[e++]:w;for(let s=e;s<n;++s)r>t[s]&&(r=t[s]);return r}function Rt(t){return $t(t)?t:+t}function ss(t,e){const n=t.length;if(!n)return w;if((e=+e)<=0||n<2)return Rt(t[0]);if(e>=1)return Rt(t[n-1]);const r=(n-1)*e,s=Math.floor(r),a=Rt(t[s]);return $t(a)?a:a+(Rt(t[s+1])-a)*(r-s)}let as=class{constructor(e){this._values=e||[],this._sorted=null,this._start=0}values(e){return this._start&&(this._values=this._values.slice(this._start),this._start=0),e?this._values.slice():this._values}add(e){this._values.push(e),this._sorted=null}rem(){this._start+=1,this._sorted=null}min(){return this._sorted&&this._sorted.length?this._sorted[0]:rs(this._values,this._start)}max(){return this._sorted&&this._sorted.length?this._sorted[this._sorted.length-1]:ns(this._values,this._start)}quantile(e){return this._sorted||(this._sorted=this.values(!0),this._sorted.sort(re)),ss(this._sorted,e)}};const zt=(t,e,n)=>dt(e,"{"+vt(t,(r,s)=>`_${s}.${n}(${e});`)+"}",t);function is(t,e){const{ops:n,output:r}=os(t,e),s=t[0].fields,a=s.length,i=a===0?se:a===1?us:a===2?ls:M("Unsupported field count: "+a);return new i(s,n,r,e)}function os(t,e){const n={},r=[];function s(i,o=[]){const u=i+":"+o;if(n[u])return n[u];const l=Ke(i),c=l.create(...o);return e<0&&l.stream&&l.stream.forEach(d=>s(d,[])),l.req&&l.req.forEach(d=>s(d,[])),n[u]=c,r.push(c),c}const a=t.map(i=>{const o=s(i.name,i.params);return o.output=i.id,o});return{ops:r,output:a}}let se=class extends Be{constructor(e,n,r,s){super(r),this._op=n,this._fields=e,this._stream=!!s}init(){const e={count:0,valid:0,stream:this._stream};return this._op.forEach(n=>n.init(e)),e.values&&(e.list=new as),e}write(e,n,r){const s=this._outputs,a=s.length;for(let i=0;i<a;++i)n[s[i].output][r]=s[i].value(e);return 1}_add(){}_rem(){}add(e){++e.count}rem(e){--e.count}},us=class extends se{constructor(e,n,r,s){super(e,n,r,s);const a=["state","v1","v2"];this._add=zt(n,a,"add"),this._rem=zt(n,a,"rem")}add(e,n,r){const s=this._fields[0](n,r);++e.count,L(s)&&(++e.valid,e.list&&e.list.add(s),this._add(e,s))}rem(e,n,r){const s=this._fields[0](n,r);--e.count,L(s)&&(--e.valid,e.list&&e.list.rem(),this._rem(e,s))}},ls=class extends se{constructor(e,n,r,s){super(e,n,r,s);const a=["state","v1","v2"];this._add=zt(n,a,"add"),this._rem=zt(n,a,"rem")}add(e,n,r){const s=this._fields[0](n,r),a=this._fields[1](n,r);++e.count,L(s)&&L(a)&&(++e.valid,e.list&&e.list.add([s,a]),this._add(e,s,a))}rem(e,n,r){const s=this._fields[0](n,r),a=this._fields[1](n,r);--e.count,L(s)&&L(a)&&(--e.valid,e.list&&e.list.rem(),this._rem(e,s,a))}};function T(t){return typeof t=="function"}function mt(t,e){const n=Array(t);if(T(e))for(let r=0;r<t;++r)n[r]=e(r);else n.fill(e);return n}function ot(t,e,n){if(e.length){const r=t.data(),{keys:s}=t.groups()||{},a=ht(t,e),i=s?(o,u)=>a[o][s[u]]:o=>a[o][0];n=n.map(o=>u=>o(u,r,i))}return n}function ht(t,e,n){if(!e.length)return n;const r=en(e),s=t.groups(),a=s?s.size:1;return n=n||mt(e.length,()=>Array(a)),a>1?r.forEach(i=>{const o=rn(t,i,s);for(let u=0;u<a;++u)i.write(o[u],n,u)}):r.forEach(i=>{const o=nn(t,i);i.write(o,n,0)}),n}function en(t,e){const n=[],r={};for(const s of t){const a=s.fields.map(i=>i+"").join(",");(r[a]||(r[a]=[])).push(s)}for(const s in r)n.push(is(r[s],e));return n}function nn(t,e){const n=e.init(),r=t.totalRows(),s=t.data(),a=t.mask();if(t.isOrdered()){const i=t.indices();for(let o=0;o<r;++o)e.add(n,i[o],s)}else if(a)for(let i=a.next(0);i>=0;i=a.next(i+1))e.add(n,i,s);else for(let i=0;i<r;++i)e.add(n,i,s);return n}function rn(t,e,n){const{keys:r,size:s}=n,a=mt(s,()=>e.init()),i=t.data();if(t.isOrdered()){const o=t.indices(),u=o.length;for(let l=0;l<u;++l){const c=o[l];e.add(a[r[c]],c,i)}}else if(t.isFiltered()){const o=t.mask();for(let u=o.next(0);u>=0;u=o.next(u+1))e.add(a[r[u]],u,i)}else{const o=t.totalRows();for(let u=0;u<o;++u)e.add(a[r[u]],u,i)}return a}function sn(t,e){const{get:n,names:r,rows:s,size:a}=e,i=r.length;for(let o=0;o<i;++o){const u=t.add(r[o],Array(a)),l=n[o];for(let c=0;c<a;++c)u[c]=l(s[c])}}const cs="ArrayPattern",fs="ArrowFunctionExpression",ds="FunctionExpression",st="Identifier",pt="Literal",an="MemberExpression",ms="ObjectExpression",on="ObjectPattern",un="Property",ln="Column",hs="Constant",ps="Dictionary",gs="Function",$s="Parameter",cn="Op";function _(t,e,n,r){const s=n[t.type]||n.Default;if(s&&s(t,e,r)===!1)return;const a=vs[t.type];a&&a(t,e,n)}const It=(t,e,n)=>{_(t.argument,e,n,t)},ae=(t,e,n)=>{_(t.left,e,n,t),_(t.right,e,n,t)},fn=(t,e,n)=>{_(t.test,e,n,t),_(t.consequent,e,n,t),t.alternate&&_(t.alternate,e,n,t)},ie=(t,e,n)=>{Y(t.params,e,n,t),_(t.body,e,n,t)},dn=(t,e,n)=>{_(t.callee,e,n,t),Y(t.arguments,e,n,t)},Y=(t,e,n,r)=>{t.forEach(s=>_(s,e,n,r))},vs={TemplateLiteral:(t,e,n)=>{Y(t.expressions,e,n,t),Y(t.quasis,e,n,t)},MemberExpression:(t,e,n)=>{_(t.object,e,n,t),_(t.property,e,n,t)},CallExpression:dn,NewExpression:dn,ArrayExpression:(t,e,n)=>{Y(t.elements,e,n,t)},AssignmentExpression:ae,AwaitExpression:It,BinaryExpression:ae,LogicalExpression:ae,UnaryExpression:It,UpdateExpression:It,ConditionalExpression:fn,ObjectExpression:(t,e,n)=>{Y(t.properties,e,n,t)},Property:(t,e,n)=>{_(t.key,e,n,t),_(t.value,e,n,t)},ArrowFunctionExpression:ie,FunctionExpression:ie,FunctionDeclaration:ie,VariableDeclaration:(t,e,n)=>{Y(t.declarations,e,n,t)},VariableDeclarator:(t,e,n)=>{_(t.id,e,n,t),_(t.init,e,n,t)},SpreadElement:(t,e,n)=>{_(t.argument,e,n,t)},BlockStatement:(t,e,n)=>{Y(t.body,e,n,t)},ExpressionStatement:(t,e,n)=>{_(t.expression,e,n,t)},IfStatement:fn,ForStatement:(t,e,n)=>{_(t.init,e,n,t),_(t.test,e,n,t),_(t.update,e,n,t),_(t.body,e,n,t)},WhileStatement:(t,e,n)=>{_(t.test,e,n,t),_(t.body,e,n,t)},DoWhileStatement:(t,e,n)=>{_(t.body,e,n,t),_(t.test,e,n,t)},SwitchStatement:(t,e,n)=>{_(t.discriminant,e,n,t),Y(t.cases,e,n,t)},SwitchCase:(t,e,n)=>{t.test&&_(t.test,e,n,t),Y(t.consequent,e,n,t)},ReturnStatement:It,Program:(t,e,n)=>{_(t.body[0],e,n,t)}};function mn(t){delete t.start,delete t.end,delete t.optional}function hn(t){mn(t),delete t.object,delete t.property,delete t.computed,t.table||delete t.table}function ys(t){return _(t,null,{Column:hn,Constant:hn,Default:mn}),t}function C(t,e){return e&&e.type===t}function _s(t){return C(ds,t)||C(fs,t)}const j=(t,e)=>{const n=xs[t.type];return n?n(t,e):M(`Unsupported expression construct: ${t.type}`)},oe=(t,e)=>"("+j(t.left,e)+" "+t.operator+" "+j(t.right,e)+")",ue=(t,e)=>"("+Q(t.params,e)+")=>"+j(t.body,e),pn=(t,e)=>j(t.callee,e)+"("+Q(t.arguments,e)+")",Q=(t,e,n=",")=>t.map(r=>j(r,e)).join(n),le=t=>t.computed?`[${J(t.name)}]`:`.${t.name}`,gn=(t,e,n)=>{const r=t.table||"";return`data${r}${le(t)}.${n}(${e.index}${r})`},ws=(t,e)=>{const n=t.table||"";return`data${n}${le(t)}[${e.index}${n}]`},xs={Constant:t=>t.raw,Column:(t,e)=>t.array?ws(t,e):gn(t,e,"at"),Dictionary:(t,e)=>gn(t,e,"key"),Function:t=>`fn.${t.name}`,Parameter:t=>`$${le(t)}`,Op:(t,e)=>`op(${J(t.name)},${e.op||e.index})`,Literal:t=>t.raw,Identifier:t=>t.name,TemplateLiteral:(t,e)=>{const{quasis:n,expressions:r}=t,s=r.length;let a=n[0].value.raw;for(let i=0;i<s;)a+="${"+j(r[i],e)+"}"+n[++i].value.raw;return"`"+a+"`"},MemberExpression:(t,e)=>{const n=!t.computed,r=j(t.object,e),s=j(t.property,e);return r+(n?"."+s:"["+s+"]")},CallExpression:pn,NewExpression:(t,e)=>"new "+pn(t,e),ArrayExpression:(t,e)=>"["+Q(t.elements,e)+"]",AssignmentExpression:oe,BinaryExpression:oe,LogicalExpression:oe,UnaryExpression:(t,e)=>"("+t.operator+j(t.argument,e)+")",ConditionalExpression:(t,e)=>"("+j(t.test,e)+"?"+j(t.consequent,e)+":"+j(t.alternate,e)+")",ObjectExpression:(t,e)=>"({"+Q(t.properties,e)+"})",Property:(t,e)=>{const n=j(t.key,e);return(t.computed?`[${n}]`:n)+":"+j(t.value,e)},ArrowFunctionExpression:ue,FunctionExpression:ue,FunctionDeclaration:ue,ArrayPattern:(t,e)=>"["+Q(t.elements,e)+"]",ObjectPattern:(t,e)=>"{"+Q(t.properties,e)+"}",VariableDeclaration:(t,e)=>t.kind+" "+Q(t.declarations,e,","),VariableDeclarator:(t,e)=>j(t.id,e)+"="+j(t.init,e),SpreadElement:(t,e)=>"..."+j(t.argument,e),BlockStatement:(t,e)=>"{"+Q(t.body,e,";")+";}",BreakStatement:()=>"break",ExpressionStatement:(t,e)=>j(t.expression,e),IfStatement:(t,e)=>"if ("+j(t.test,e)+")"+j(t.consequent,e)+(t.alternate?" else "+j(t.alternate,e):""),SwitchStatement:(t,e)=>"switch ("+j(t.discriminant,e)+") {"+Q(t.cases,e,"")+"}",SwitchCase:(t,e)=>(t.test?"case "+j(t.test,e):"default")+": "+Q(t.consequent,e,";")+";",ReturnStatement:(t,e)=>"return "+j(t.argument,e),Program:(t,e)=>j(t.body[0],e)};function qt(t,e={index:"row"}){return j(t,e)}function yt(t,e,n){return t=`"use strict"; return ${t};`,Function("fn","$",t)(e,n)}var ce={escape:(t,e,n)=>yt(t,e,n),expr:(t,e)=>yt(`(row,data,op)=>${t}`,rt,e),expr2:(t,e)=>yt(`(row0,data0,row,data)=>${t}`,rt,e),join:(t,e)=>yt(`(row1,data1,row2,data2)=>${t}`,rt,e),param:(t,e)=>yt(t,rt,e)};function Pt(t){return D(t)?t:Zt(t)?t.entries():t?Object.entries(t):[]}const bs={"==":1,"!=":1,"===":1,"!==":1};function $n(t,e,n=0,r=void 0,s=void 0){if(t.type=ln,t.name=e,t.table=n,K(r)&&(t.array=!0),s&&r&&T(r.keyFor)){const a=bs[s.operator]?s.left===t?s.right:s.left:s.callee&&s.callee.name==="equal"?s.arguments[s.arguments[0]===t?1:0]:null;a&&a.type===pt&&Ms(s,t,a,r.keyFor(a.value))}return t}function Ms(t,e,n,r){return r<0?(t.type=pt,t.value=!1,t.raw="false"):(e.type=ps,n.value=r,n.raw=r+""),!0}const Lt="row_object";function vn(t,e,n=e.columnNames()){t.type=ms;const r=t.properties=[];for(const s of Pt(n)){const[a,i]=D(s)?s:[s,s];r.push({type:un,key:{type:pt,raw:J(i)},value:$n({computed:!0},a,0,e.column(a))})}return t}function yn(t,e){return qt(vn({},t,e))}function _n(t,e){return ce.expr(yn(t,e))}function Es(t){return T(t)?t:()=>t}const js="Escaped functions are not valid as rollup or pivot values.";function ks(t,e,n){t.aggronly&&M(js);const r=`(row,data)=>fn(${yn(t.table)},$)`;return{escape:ce.escape(r,Es(e.expr),n)}}var fe={undefined:"void(0)",Infinity:"Number.POSITIVE_INFINITY",NaN:"Number.NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"};function Z(t){return typeof t=="number"}const As={ecmaVersion:11},wn="$",Ns="d",Ss="d1",Os="d2",U=t=>(e,n)=>n.error(e,t+" not allowed"),Cs=U("Aggregate function"),Fs=U("Window function"),Ts="Invalid argument",de="Invalid column reference",Us=de+" (must be input to an aggregate function)",xn="Invalid function call",Ds="Invalid member expression",Rs="Invalid operator parameter",zs="Invalid param reference",Is="Invalid variable reference",qs="Variable not accessible in operator call",Ps="Unsupported variable declaration",Ls="Unsupported destructuring pattern",bn="Table expressions do not support closures",Mn="Use aq.escape(fn) to use a function as-is (including closures)",Vs="use table.params({ name: value }) to define dynamic parameters",Js="use aq.addFunction(name, fn) to add new op functions",Gs=`
Note: ${bn}. ${Mn}, or ${Vs}.`,En=`
Note: ${bn}. ${Mn}, or ${Js}.`,Hs=`The ${Lt} method is not valid in multi-table expressions.`;function Ws(t,e){const n=Bs(e);let r=t.root=n;return t.spec=e,t.tuple=null,t.tuple1=null,t.tuple2=null,t.$param=null,t.$op=0,t.scope=new Set,t.paramsRef=new Map,t.columnRef=new Map,_s(r)?(Qs(r,t),r=r.body):t.join?(t.scope.add(t.tuple1=Ss),t.scope.add(t.tuple2=Os),t.scope.add(t.$param=wn)):(t.scope.add(t.tuple=Ns),t.scope.add(t.$param=wn)),_(r,t,me),t.root}function Bs(t){try{const e=t.field?Ys(t):D(t)?J(t):t;return wr(`expr=(${e})`,As).body[0].expression.right}catch{M(`Expression parse error: ${t+""}`)}}function Ys(t){const e=JSON.stringify(t+"");return t.table?`(a,b)=>b[${e}]`:`d=>d[${e}]`}const me={FunctionDeclaration:U("Function definitions"),ForStatement:U("For loops"),ForOfStatement:U("For-of loops"),ForInStatement:U("For-in loops"),WhileStatement:U("While loops"),DoWhileStatement:U("Do-while loops"),AwaitExpression:U("Await expressions"),ArrowFunctionExpression:U("Function definitions"),AssignmentExpression:U("Assignments"),FunctionExpression:U("Function definitions"),NewExpression:U('Use of "new"'),UpdateExpression:U("Update expressions"),VariableDeclarator(t,e){ge(t.id,e)},Identifier(t,e,n){Nn(t,e,n)&&!e.scope.has(t.name)&&e.error(t,Is,Gs)},CallExpression(t,e){const n=kn(t.callee),r=Ke(n)||tn(n);if(r){if((e.join||e.aggregate===!1)&&ee(n)&&Cs(t,e),(e.join||e.window===!1)&&ne(n)&&Fs(t,e),e.$op=1,e.ast)pe(t,n,e),t.arguments.forEach(s=>_(s,e,he));else{const s=e.op(Zs(e,r,n,t.arguments));Object.assign(t,{type:cn,name:s.id})}return e.$op=0,!1}else Xe(n)?pe(t,n,e):e.error(t,xn,En)},MemberExpression(t,e,n){const{object:r,property:s}=t;if(!C(st,r))return;const{name:a}=r;if(An(t)&&C(st,s)&&V(fe,s.name)){Cn(t,s.name);return}const i=a===e.tuple?0:a===e.tuple1?1:a===e.tuple2?2:-1;if(i>=0)return jn(t,i,e,Sn,n);if(a===e.$param)return jn(t,i,e,Ks);e.paramsRef.has(a)?wt(t,e.paramsRef.get(a)):e.columnRef.has(a)?On(r,a,e,t):V(e.params,a)&&wt(r,a)}};function jn(t,e,n,r,s){const{property:a,computed:i}=t;let o;if(!i)o=a.name;else if(C(pt,a))o=a.value;else try{_(a,n,me,t),o=n.param(a)}catch{n.error(t,Ds)}return r(t,o,e,n,s),!1}const he={...me,VariableDeclarator:U("Variable declaration in operator call"),Identifier(t,e,n){Nn(t,e,n)&&e.error(t,qs)},CallExpression(t,e){const n=kn(t.callee);Xe(n)?pe(t,n,e):e.error(t,xn,En)}};function Qs(t,e){t.generator&&U("Generator functions")(t,e),t.async&&U("Async functions")(t,e);const{params:n}=t,r=n.length,s=i=>(o,u)=>e.columnRef.set(o,[u,i]),a=(i,o)=>e.paramsRef.set(i,o);r&&(e.join?(_t(e,n[0],"tuple1",s(1)),r>1&&_t(e,n[1],"tuple2",s(2)),r>2&&_t(e,n[2],"$param",a)):(_t(e,n[0],"tuple",s(0)),r>1&&_t(e,n[1],"$param",a))),e.root=t.body}function _t(t,e,n,r){C(st,e)?(t.scope.add(e.name),t[n]=e.name):C(on,e)&&e.properties.forEach(s=>{const a=C(st,s.key)?s.key.name:C(pt,s.key)?s.key.value:t.error(s,Ts);C(st,s.value)||t.error(s.value,Ls),r(s.value.name,a)})}function Zs(t,e,n,r){const s=[],a=[],i=e.param[0]||0,o=i+(e.param[1]||0);return r.forEach((u,l)=>{l<i?(_(u,t,he),s.push(t.field(u))):l<o?(_(u,t,he),a.push(t.param(u))):t.error(u,Rs)}),{name:n,fields:s,params:a,...t.spec.window||{}}}function kn(t){return C(st,t)?t.name:C(an,t)?An(t)?Xs(t.property.name):t.property.name:null}function An(t){return C(st,t.object)&&t.object.name==="Math"}function Xs(t){return t==="max"?"greatest":t==="min"?"least":t}function Nn(t,e,n){const{name:r}=t;if(!(C(an,n)&&n.property===t)&&!(C(un,n)&&n.key===t))if(e.paramsRef.has(r))wt(t,e.paramsRef.get(r));else if(e.columnRef.has(r))On(t,r,e,n);else if(V(e.params,r))wt(t,r);else if(V(fe,r))Cn(t,r);else return!0}function Sn(t,e,n,r,s){const a=n===0?r.table:n>0?r.join[n-1]:null,i=a&&a.column(e);a&&!i&&r.error(t,de),r.aggronly&&!r.$op&&r.error(t,Us),$n(t,e,n,i,s)}function On(t,e,n,r){const[s,a]=n.columnRef.get(e);Sn(t,s,a,n,r)}function Ks(t,e,n,r){r.params&&!V(r.params,e)&&r.error(t,zs),wt(t,e)}function wt(t,e){t.type=$s,t.name=e}function Cn(t,e){t.type=hs,t.name=e,t.raw=fe[e]}function pe(t,e,n){if(e===Lt){const r=n.table;r||n.error(t,Hs),vn(t,r,t.arguments.length?t.arguments.map(s=>{const a=n.param(s),i=Z(a)?r.columnName(a):a;return r.column(i)||n.error(s,de),i}):r.columnNames())}else t.callee={type:gs,name:e}}function ge(t,e){C(st,t)?e.scope.add(t.name):C(cs,t)?t.elements.forEach(n=>ge(n,e)):C(on,t)?t.properties.forEach(n=>ge(n.value,e)):e.error(t.id,Ps)}const ta={[ln]:1,[cn]:1};function z(t,e={}){const n=e.generate||qt,r=e.compiler||ce,s=na(e),a={},i={},o=[],u=[];let l=0,c=-1;const d=e.join?r.join:e.index==1?r.expr2:r.expr,f={op(p){const g=ea(p);return i[g]||(p.id=++c,i[g]=p)},field(p){const g=n(p);return a[g]||(a[g]=++l)},param(p){return C(pt,p)?p.value:r.param(n(p),s)},value(p,g){o.push(p);const $=g.escape||(e.ast?ys(g):d(n(g),s));u.push($),ta[g.type]&&$!==g&&tt($)&&($.field=g.name)},error(p,g,$=""){const x=p.start-6,y=p.end-6,E=String(f.spec).slice(x,y);M(`${g}: "${E}"${$}`)}};Object.assign(f,e,{params:s});for(const[p,g]of Pt(t))f.value(p+"",g.escape?ks(f,g,s):Ws(f,g));if(e.ast)return{names:o,exprs:u};const m=[];for(const p in a)m[a[p]]=r.expr(p,s);const h=Object.values(i);return h.forEach(p=>p.fields=p.fields.map(g=>m[g])),{names:o,exprs:u,ops:h}}function ea(t){let e=`${t.name}(${t.fields.concat(t.params).join(",")})`;if(t.frame){const n=t.frame.map(r=>Number.isFinite(r)?Math.abs(r):-1);e+=`[${n},${!!t.peers}]`}return e}function na(t){return(t.table?$e(t.table):t.join?{...$e(t.join[1]),...$e(t.join[0])}:{})||{}}function $e(t){return t&&T(t.params)?t.params():{}}function xt(t,e){return t&&t.expr?new Fn({...t,...e}):new Fn(e,t)}let Fn=class{constructor(e,n){this.expr=n,Object.assign(this,e)}toString(){return String(this.expr)}toObject(){return{...this,expr:this.toString(),...T(this.expr)?{func:!0}:{}}}};function bt(t,e,n=0){const r=n?{field:!0,table:n}:{field:!0};return xt(t,e?{expr:e,...r}:r)}function Tn(t,e){for(const[n,r]of Pt(e))t.set(n,r);return t}function ve(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function X(t,e,n=new Map){return e=Z(e)?t.columnName(e):e,R(e)?n.set(e,e):D(e)?e.forEach(r=>X(t,r,n)):T(e)?X(t,e(t),n):tt(e)?Tn(n,e):M(`Invalid column selection: ${J(e)}`),n}function Vt(t,e){return t.toObject=e,t}function Un(t){return D(t)?t.map(Un):t&&t.toObject?t.toObject():t}function ut(){return Vt(t=>t.columnNames(),()=>({all:[]}))}function ye(...t){return t=t.flat(),Vt(e=>{const n=X(e,t);return e.columnNames(r=>!n.has(r))},()=>({not:Un(t)}))}function ra(t,e){return Vt(n=>{let r=Z(t)?t:n.columnIndex(t),s=Z(e)?e:n.columnIndex(e);if(s<r){const a=s;s=r,r=a}return n.columnNames().slice(r,s+1)},()=>({range:[t,e]}))}function _e(t){return R(t)&&(t=RegExp(ve(t))),Vt(e=>e.columnNames(n=>t.test(n)),()=>({matches:[t.source,t.flags]}))}function sa(t){return _e(RegExp("^"+ve(t)))}function aa(t){return _e(RegExp(ve(t)+"$"))}function G(t,e,n,r={window:!1}){const s=new Map,a=i=>{i=Z(i)?e.columnName(i):i,R(i)?s.set(i,bt(i)):T(i)?X(e,i).forEach(a):tt(i)?Tn(s,i):M(`Invalid ${t} value: ${i+""}`)};return B(n).forEach(a),r.preparse&&r.preparse(s),z(s,{table:e,...r})}function we(t,...e){return ia(t,G("groupby",t,e.flat()))}function ia(t,e){return t.create({groups:oa(t,e)})}function oa(t,{names:e=[],exprs:n=[],ops:r=[]}){const s=e.length;if(s===0)return null;if(s===1&&!t.isFiltered()&&n[0].field){const m=t.column(n[0].field);if(m.groups)return m.groups(e)}let a=ot(t,r,n);const i=Dt(a),o=t.totalRows(),u=new Uint32Array(o),l={},c=[],d=t.data(),f=t.mask();if(f)for(let m=f.next(0);m>=0;m=f.next(m+1)){const h=i(m,d)+"";u[m]=l[h]??=c.push(m)-1}else for(let m=0;m<o;++m){const h=i(m,d)+"";u[m]=l[h]??=c.push(m)-1}return r.length||(a=a.map(m=>h=>m(h,d))),{keys:u,get:a,names:e,rows:c,size:c.length}}function I(t){return t?new Dn({...t.data()},t.columnNames()):new Dn}let Dn=class{constructor(e,n){this.data=e||{},this.names=n||[]}add(e,n){return this.has(e)||this.names.push(e+""),this.data[e]=n}has(e){return V(this.data,e)}groupby(e){return this.groups=e,this}new(e){const{data:n,names:r,groups:s=null}=this;return e.create({data:n,names:r,groups:s,filter:null,order:null})}derive(e){return e.create(this)}};function Mt(t,e){return xe(t,z(e,{table:t,aggronly:!0,window:!1}))}function xe(t,{names:e,exprs:n,ops:r=[]}){const s=I(),a=t.groups();return a&&sn(s,a),ua(e,n,a,ht(t,r),s),s.new(t)}function ua(t,e,n,r=[],s){if(!e.length)return;const a=n?n.size:1,i=(u,l)=>r[u][l],o=t.length;for(let u=0;u<o;++u){const l=e[u];if(l.field!=null)s.add(t[u],r[l.field]);else if(a>1){const c=s.add(t[u],Array(a));for(let d=0;d<a;++d)c[d]=l(d,null,i)}else s.add(t[u],[l(0,null,i)])}}function Rn(t,...e){return be(t,X(t,e.flat()))}function be(t,e){const n=I();return e.forEach((r,s)=>{const a=R(r)?r:s;if(a){const i=t.column(s)||M(`Unrecognized column: ${s}`);n.add(a,i)}}),n.derive(t)}function la(t,e){if(!t||!e)return t;const{keys:n,rows:r,size:s}=t,a=new Uint32Array(s);e.scan(c=>a[n[c]]=1);const i=a.reduce((c,d)=>c+d,0);if(i===s)return t;const o=Array(i);let u=0;for(let c=0;c<s;++c)a[c]&&(o[a[c]=u++]=r[c]);const l=new Uint32Array(n.length);return e.scan(c=>l[c]=a[n[c]]),{...t,keys:l,rows:o,size:u}}function ca(t,e,n,r){const{keys:s,rows:a,size:i}=t;let o=a,u=i,l=null;if(n){l=new Int32Array(i),e(m=>l[s[m]]=1);const f=l.reduce((m,h)=>m+h,0);if(f!==i){o=Array(f),u=0;for(let m=0;m<i;++m)l[m]&&(o[l[m]=u++]=a[m])}}let c=-1;const d=new Uint32Array(r);return e(u!==i?f=>d[++c]=l[s[f]]:f=>d[++c]=s[f]),{...t,keys:d,rows:o,size:u}}function fa(t,e,n,r){const s=r==="map"||r===!0?Ge:r==="entries"?We:r==="object"?He:M('groups option must be "map", "entries", or "object".'),{names:a}=t.groups(),i=Qr(t.columnNames(),"_");let o=Rn(t,{}).reify(e).create({data:{[i]:n}});o=Mt(o,{[i]:Ve(i)});for(let u=a.length;--u>=0;)o=Mt(we(o,a.slice(0,u)),{[i]:s(a[u],i)});return o.get(i)}function da(t){return St(t)?t.constructor:Array}let Jt=class{constructor(e,n,r,s,a,i){const o=Object.freeze({...e});n=n?.slice()??Object.keys(o);const u=n.length?o[n[0]].length:0;this._names=Object.freeze(n),this._data=o,this._total=u,this._nrows=r?.count()??u,this._mask=r??null,this._group=s??null,this._order=a??null,this._params=i,this._index=null,this._partitions=null}create({data:e=void 0,names:n=void 0,filter:r=void 0,groups:s=void 0,order:a=void 0}={}){const i=r!==void 0?r:this.mask();return new this.constructor(e||this._data,n||(e?null:this._names),i,s!==void 0?s:la(this._group,r&&i),a!==void 0?a:this._order,this._params)}params(e){return arguments.length?(e&&(this._params={...this._params,...e}),this):this._params}get[Symbol.toStringTag](){if(!this._names)return"Object";const e=this.numRows(),n=this.numCols(),r=s=>s!==1?"s":"";return`Table: ${n} col${r(n)} x ${e} row${r(e)}`+(this.isFiltered()?` (${this.totalRows()} backing)`:"")+(this.isGrouped()?`, ${this._group.size} groups`:"")+(this.isOrdered()?", ordered":"")}isFiltered(){return!!this._mask}isGrouped(){return!!this._group}isOrdered(){return!!this._order}data(){return this._data}mask(){return this._mask}groups(){return this._group}comparator(){return this._order}totalRows(){return this._total}numRows(){return this._nrows}get size(){return this._nrows}numCols(){return this._names.length}columnNames(e){return e?this._names.filter(e):this._names.slice()}columnName(e){return this._names[e]}columnIndex(e){return this._names.indexOf(e)}column(e){return this._data[e]}columnAt(e){return this._data[this._names[e]]}array(e,n=Array){const r=this.column(e),s=new n(this.numRows());let a=-1;return this.scan(i=>s[++a]=r.at(i),!0),s}get(e,n=0){const r=this.column(e);return this.isFiltered()||this.isOrdered()?r.at(this.indices()[n]):r.at(n)}getter(e){const n=this.column(e),r=this.isFiltered()||this.isOrdered()?this.indices():null;if(r)return s=>n.at(r[s]);if(n)return s=>n.at(s);M(`Unrecognized column: ${e}`)}object(e=0){return zn(this)(e)}objects(e={}){const{grouped:n,limit:r,offset:s}=e,a=X(this,e.columns||ut()),i=_n(this,a),o=[];if(this.scan((u,l)=>o.push(i(u,l)),!0,r,s),n&&this.isGrouped()){const u=[];return this.scan(l=>u.push(l),!0,r,s),fa(this,u,o,n)}return o}*[Symbol.iterator](){const e=zn(this),n=this.numRows();for(let r=0;r<n;++r)yield e(r)}*values(e){const n=this.getter(e),r=this.numRows();for(let s=0;s<r;++s)yield n(s)}print(e={}){const n=Z(e)?{limit:+e}:{...e,limit:10},r=this.objects({...n,grouped:!1}),s=`${this[Symbol.toStringTag]}. Showing ${r.length} rows.`;return console.log(s),console.table(r),this}indices(e=!0){if(this._index)return this._index;const n=this.numRows(),r=new Uint32Array(n),s=this.isOrdered(),a=this.mask();let i=-1;if(a)for(let o=a.next(0);o>=0;o=a.next(o+1))r[++i]=o;else for(let o=0;o<n;++o)r[++i]=o;if(e&&s){const{_order:o,_data:u}=this;r.sort((l,c)=>o(l,c,u))}return(e||!s)&&(this._index=r),r}partitions(e=!0){if(this._partitions)return this._partitions;if(!this.isGrouped())return[this.indices(e)];const{keys:n,size:r}=this._group,s=mt(r,()=>[]),a=this._index,i=this.mask(),o=this.numRows();if(a&&this.isOrdered())for(let u=0,l;u<o;++u)l=a[u],s[n[l]].push(l);else if(i)for(let u=i.next(0);u>=0;u=i.next(u+1))s[n[u]].push(u);else for(let u=0;u<o;++u)s[n[u]].push(u);if(e&&!a&&this.isOrdered()){const u=this._order,l=this._data;for(let c=0;c<r;++c)s[c].sort((d,f)=>u(d,f,l))}return(e||!this.isOrdered())&&(this._partitions=s),s}reify(e){const n=e?e.length:this.numRows(),r=this._names;let s,a;if(!e&&!this.isOrdered())if(this.isFiltered())n===this.totalRows()&&(s=this.data());else return this;if(!s){const i=e?u=>e.forEach(u):u=>this.scan(u,!0),o=r.length;s={};for(let u=0;u<o;++u){const l=r[u],c=this.column(l),d=s[l]=new(da(c))(n);let f=-1;K(c)?i(m=>d[++f]=c[m]):i(m=>d[++f]=c.at(m))}this.isGrouped()&&(a=ca(this.groups(),i,!!e,n))}return this.create({data:s,names:r,groups:a,filter:null,order:null})}scan(e,n,r=1/0,s=0){const a=this._mask,i=this._nrows,o=this._data;let u=s||0;if(u>i)return;const l=Math.min(i,u+r),c=()=>u=this._total;if(n&&this.isOrdered()||a&&this._index){const d=this.indices(),f=this._data;for(;u<l;++u)e(d[u],f,c)}else if(a){let d=l-u+1;for(u=a.nth(u);--d&&u>-1;u=a.next(u+1))e(u,o,c)}else for(;u<l;++u)e(u,o,c)}};function zn(t){let e=t._builder;if(!e){const n=_n(t),r=t.data();if(t.isOrdered()||t.isFiltered()){const s=t.indices();e=a=>n(s[a],r)}else e=s=>n(s,r);t._builder=e}return e}function ma(t,...e){e=e.flat();const n=t.numRows(),r=t.reify(),s=I(r).groupby(r.groups());return e.forEach(a=>{a=a instanceof Jt?a:new Jt(a),a.numRows()!==n&&M("Assign row counts do not match"),a=a.reify(),a.columnNames(i=>s.add(i,a.column(i)))}),s.new(t)}function In(t,...e){e=e.flat();const n=t.numRows(),r=n+e.reduce((i,o)=>i+o.numRows(),0);if(n===r)return t;const s=[t,...e],a=I();return t.columnNames().forEach(i=>{const o=Array(r);let u=0;s.forEach(l=>{const c=l.column(i)||{at:()=>w};l.scan(d=>o[u++]=c.at(d))}),a.add(i,o)}),a.new(t)}function qn(t,e,{before:n=void 0,after:r=void 0}={}){const s=n!=null,a=r!=null;s||a||M("relocate requires a before or after option."),s&&a&&M("relocate accepts only one of the before or after options."),e=X(t,e);const i=[...X(t,s?n:r).keys()],o=s?i[0]:i.pop(),u=new Map;return t.columnNames().forEach(l=>{const c=!e.has(l);if(l===o){a&&c&&u.set(l,l);for(const[d,f]of e)u.set(d,f);if(a)return}c&&u.set(l,l)}),be(t,u)}function Pn(t){return{left(e,n,r,s){for(r==null&&(r=0),s==null&&(s=e.length);r<s;){const a=r+s>>>1;t(e[a],n)<0?r=a+1:s=a}return r},right(e,n,r,s){for(r==null&&(r=0),s==null&&(s=e.length);r<s;){const a=r+s>>>1;t(e[a],n)>0?s=a:r=a+1}return r}}}const Ln=Pn(re);function ha(t,e,n,r,s){let a,i,o,u,l;const c=p=>i[p-1]===i[p],d=r.length,f=s.length,m=r.length?dt(["w","r","k"],"{"+vt(r,(p,g)=>`r[_${g}.id][k]=_${g}.value(w,_${g}.get);`)+"}",r):()=>{},h={i0:0,i1:0,index:0,size:0,peer:c,init(p,g,$,x){h.index=h.i0=h.i1=0,h.size=g.length,a=p,i=g,u=$,l=x,o=s?s.map(y=>y.init()):null;for(let y=0;y<d;++y)r[y].init();return h},value(p,g){return g(a[p],t)},step(p){const[g,$]=e,x=h.size,y=h.i0,E=h.i1;h.i0=g!=null?Math.max(0,p-Math.abs(g)):0,h.i1=$!=null?Math.min(x,p+Math.abs($)+1):x,h.index=p,n&&(h.i0>0&&c(h.i0)&&(h.i0=Ln.left(i,i[h.i0])),h.i1<x&&c(h.i1)&&(h.i1=Ln.right(i,i[h.i1-1])));for(let F=0;F<f;++F){const b=s[F],P=o[F];for(let k=y;k<h.i0;++k)b.rem(P,a[k],t);for(let k=E;k<h.i1;++k)b.add(P,a[k],t);b.write(P,u,l)}return m(h,u,l),u}};return h}const pa=t=>(t.frame||[null,null]).map(e=>Number.isFinite(e)?Math.abs(e):null),ga=t=>!!t.peers;function $a(t){const{id:e,name:n,fields:r=[],params:s=[]}=t;return{...tn(n).create(...s),get:r.length?r[0]:null,id:e}}function va(t,e,n,r={},s){const a=t.data(),i=ya(s,a),o=i.length,u=dt(["r","d","op"],"{"+vt(e,(l,c)=>`_${c}[r] = $${c}(r, d, op);`)+"}",e,n);t.partitions().forEach((l,c)=>{const d=l.length,f=_a(t,l);for(let h=0;h<o;++h)i[h].init(l,f,r,c);const m=h=>r[h][c];for(let h=0;h<d;++h){for(let p=0;p<o;++p)i[p].step(h);u(l[h],a,m)}})}function ya(t,e){const n={};return t.forEach(r=>{const s=pa(r),a=ga(r),i=`${s},${a}`,{aggOps:o,winOps:u}=n[i]||(n[i]={frame:s,peers:a,aggOps:[],winOps:[]});ee(r.name)?o.push(r):u.push($a(r))}),Object.values(n).map(r=>ha(e,r.frame,r.peers,r.winOps,en(r.aggOps,r.frame[0]!=null?-1:1)))}function _a(t,e){if(t.isOrdered()){const n=t.comparator(),r=t.data(),s=e.length,a=new Uint32Array(s);for(let i=1,o=0;i<s;++i)a[i]=n(e[i-1],e[i],r)?++o:o;return a}else return e}function wa(t){return ne(t.name)||t.frame&&(Number.isFinite(t.frame[0])||Number.isFinite(t.frame[1]))}function xa(t,e,n={}){const r=Me(t,z(e,{table:t}),n);return n.drop||n.before==null&&n.after==null?r:qn(r,Object.keys(e).filter(s=>!t.column(s)),n)}function Me(t,{names:e,exprs:n,ops:r=[]},s={}){const a=t.totalRows(),i=I(s.drop?null:t),o=e.map(f=>i.add(f,Array(a))),[u,l]=ba(r),c=t.isGrouped()?t.groups().size:1,d=ht(t,u,mt(r.length,()=>Array(c)));return l.length?va(t,o,n,d,l):Ma(t,o,n,d),i.derive(t)}function ba(t){const e=[],n=[],r=t.length;for(let s=0;s<r;++s){const a=t[s];a.id=s,(wa(a)?n:e).push(a)}return[e,n]}function Ma(t,e,n,r){const s=t.mask(),a=t.data(),{keys:i}=t.groups()||{},o=i?(l,c)=>r[l][i[c]]:l=>r[l][0],u=e.length;for(let l=0;l<u;++l){const c=n[l],d=e[l];if(s)for(let f=s.next(0);f>=0;f=s.next(f+1))d[f]=c(f,a,o);else{const f=t.totalRows();for(let m=0;m<f;++m)d[m]=c(m,a,o)}}}function Ee(t,e){const n=z({p:e},{table:t});let r=n.exprs[0];if(n.ops.length){const s=Me(t,n,{drop:!0}).column("p");r=a=>s.at(a)}return Ea(t,r)}function Ea(t,e){const n=t.totalRows(),r=t.mask(),s=t.data(),a=new Bt(n);if(r)for(let i=r.next(0);i>=0;i=r.next(i+1))e(i,s)&&a.set(i);else for(let i=0;i<n;++i)e(i,s)&&a.set(i);return t.create({filter:a})}function Gt(t,...e){e=e.flat();const n=we(t,e.length?e:t.columnNames());return Ee(n,"row_number() === 1").ungroup().reify()}function Vn(t,e){const n=new Map;return t.scan((r,s)=>{const a=e(r,s);a!=null&&a===a&&n.set(a,r)}),n}function ja(t,e,n){const r=new Map,s=t.length;for(let a=0;a<s;++a){const i=t[a],o=n(i,e);o!=null&&o===o&&(r.has(o)?r.get(o).push(a):r.set(o,[a]))}return r}function Ht(t,e,n){const r=new Map;B(n).forEach((a,i)=>{a=Z(a)?e.columnName(a):a,R(a)?r.set(i,bt(a)):T(a)||tt(a)&&a.expr?r.set(i,a):M(`Invalid ${t} key value: ${a+""}`)});const s=z(r,{table:e,aggregate:!1,window:!1});return Dt(s.exprs,!0)}function ka(t,e){const n=new Set(e);return t.filter(r=>n.has(r))}function je(t,e,n){if(n)R(n)?n=[n,n]:D(n)&&n.length===1&&(n=[n[0],n[0]]);else{const r=ka(t.columnNames(),e.columnNames());r.length||M("Natural join requires shared column names."),n=[r,r]}return n}function Jn(t,e,n,r){return n.length!==r.length&&M("Mismatched number of join keys"),[Ht("join",t,n),Ht("join",e,r)]}function Gn(t,e,n){return Wn(t,e,n,{anti:!1})}function Hn(t,e,n){return Wn(t,e,n,{anti:!0})}function Wn(t,e,n,r){n=je(t,e,n);const s=D(n)?Jn(t,e,...n.map(B)):z({on:n},{join:[t,e]}).exprs[0];return Aa(t,e,s,r)}function Aa(t,e,n,r={}){const s=new Bt(t.totalRows());return(D(n)?Na:Sa)(s,t,e,n),r.anti&&s.not().and(t.mask()),t.create({filter:s})}function Na(t,e,n,[r,s]){const a=Vn(n,s);e.scan((i,o)=>{a.get(r(i,o))>=0&&t.set(i)})}function Sa(t,e,n,r){const s=e.numRows(),a=n.numRows(),i=e.data(),o=n.data();if(e.isFiltered()||n.isFiltered()){const u=e.indices(!1),l=n.indices(!1);for(let c=0;c<s;++c){const d=u[c];for(let f=0;f<a;++f)if(r(d,i,l[f],o)){t.set(d);break}}}else for(let u=0;u<s;++u)for(let l=0;l<a;++l)if(r(u,i,l,o)){t.set(u);break}}function Oa(t,...e){if(e=e.flat(),e.length===0)return t;const n=t.columnNames();return Gt(e.reduce((r,s)=>Hn(r,s.select(n)),t))}function Ca(t,e,n){return Bn(t,G("unroll",t,e),n&&n.drop?{...n,drop:G("unroll",t,n.drop).names}:n)}function Bn(t,{names:e=[],exprs:n=[],ops:r=[]},s={}){if(!e.length)return t;const a=s.limit>0?+s.limit:1/0,i=s.index?s.index===!0?"index":s.index+"":null,o=new Set(s.drop),u=ot(t,r,n),l=I(),c=new Set(e),d=[],f=[],m=[];t.columnNames().forEach(E=>{if(!o.has(E)){const F=l.add(E,[]);c.has(E)||(d.push(t.column(E)),f.push(F))}}),e.forEach(E=>{o.has(E)||(l.has(E)||l.add(E,[]),m.push(l.data[E]))});const h=i?l.add(i,[]):null;let p=0;const g=d.length,$=m.length,x=(E,F)=>{for(let b=0;b<g;++b)f[b].length=p+F,f[b].fill(d[b].at(E),p,p+F)},y=h?(E,F)=>{for(let b=0;b<F;++b)h[E+b]=b}:()=>{};if($===1){const E=u[0],F=m[0];t.scan((b,P)=>{const k=B(E(b,P)),q=Math.min(k.length,a);x(b,q);for(let H=0;H<q;++H)F[p+H]=k[H];y(p,q),p+=q})}else t.scan((E,F)=>{let b=0;const P=u.map(k=>{const q=B(k(E,F));return b=Math.min(Math.max(b,q.length),a),q});x(E,b);for(let k=0;k<$;++k){const q=m[k],H=P[k];for(let it=0;it<b;++it)q[p+it]=H[it]}y(p,b),p+=b});return l.new(t)}function Fa(t,e,n){return Ta(t,G("fold",t,e),n)}function Ta(t,{names:e=[],exprs:n=[],ops:r=[]},s={}){if(e.length===0)return t;const[a="key",i="value"]=s.as||[],o=ot(t,r,n);return Bn(t,{names:[a,i],exprs:[()=>e,(u,l)=>o.map(c=>c(u,l))]},{...s,drop:e})}function Wt(t){return t.isGrouped()?t.create({groups:null}):t}function Ua(t,e,n={}){if(e=z(e,{table:t}),e.names.forEach(r=>t.column(r)?0:M(`Invalid impute column ${J(r)}`)),n.expand){const r={preparse:Da,window:!1,aggronly:!0},s=G("impute",t,n.expand,r),a=xe(Wt(t),s);return Yn(t,e,s.names,s.names.map(i=>a.get(i,0)))}else return Yn(t,e)}function Da(t){t.forEach((e,n)=>e.field?t.set(n,Je(e+"")):0)}function Yn(t,e,n,r){const s=n&&n.length;t=s?Ra(t,n,r):t;const{names:a,exprs:i,ops:o}=e,u=ot(t,o,i),l=s?null:I(t),c=t.totalRows();return a.forEach((d,f)=>{const m=t.column(d),h=s?m:l.add(d,Array(c)),p=u[f];t.scan(g=>{const $=m.at(g);h[g]=L($)?$:p(g)})}),s?t:t.create(l)}function Ra(t,e,n){const r=t.groups(),s=t.data(),a=(r?r.names:[]).concat(e),i=(r?r.get:[]).concat(e.map(h=>t.getter(h))),o=new Set,u=Dt(i);t.scan((h,p)=>o.add(u(h,p)));const l=t.columnNames(),c=I(),d=l.map(h=>c.add(h,[]));l.forEach((h,p)=>{const g=s[h],$=d[p];t.scan(x=>$.push(g.at(x)))});const f=Dt(i.map((h,p)=>g=>g[p])),m=dt("v","{"+d.map((h,p)=>`_${p}.push(v[$${p}]);`).join("")+"}",d,l.map(h=>a.indexOf(h)));if(r){let h=r.keys.length;const p=n.reduce(($,x)=>$*x.length,r.size),g=new Uint32Array(p+(h-o.size));g.set(r.keys),Qn(r,n,($,x)=>{o.has(f($))||(m($),g[h++]=x[0])}),c.groupby({...r,keys:g})}else Qn(r,n,h=>{o.has(f(h))||m(h)});return c.new(t)}function Qn(t,e,n){const r=t?t.get.length:0,s=t?1:0,a=s+e.length,i=new Int32Array(a),o=new Int32Array(a),u=[];if(t){const{get:c,rows:d,size:f}=t;i[0]=f,u.push((m,h)=>{const p=d[h];for(let g=0;g<r;++g)m[g]=c[g](p)})}e.forEach((c,d)=>{const f=d+r;i[d+s]=c.length,u.push((m,h)=>m[f]=c[h])});const l=Array(r+e.length);for(let c=0;c<a;++c)u[c](l,0);n(l,o);for(let c=a-1;c>=0;){const d=++o[c];d<i[c]?(u[c](l,d),n(l,o),c=a-1):(o[c]=0,u[c](l,0),--c)}}function za(t,...e){e=e.flat();const n=t.columnNames();return e.length?Gt(e.reduce((r,s)=>Gn(r,s.select(n)),t)):t.reify([])}const Ia={aggregate:!1,window:!1},qa={...Ia,index:1},Zn=-1/0;function Pa(t,e,n,r){return Et(t,e,()=>!0,n,{...r,left:!0,right:!0})}function Et(t,e,n,r,s={}){n=je(t,e,n);const a={join:[t,e]};let i;if(D(n)){const[o,u]=n.map(B);i=Jn(t,e,o,u),r||(r=La(t,o,u,s))}else i=z({on:n},a).exprs[0],r||(r=[ut(),ut()]);return Ga(t,e,i,Va(t,e,r,a,s&&s.suffix),s)}function La(t,e,n,r){const s=[];e.forEach((i,o)=>R(i)&&i===n[o]?s.push(i):0);const a=ye(s);if(r.left&&r.right){const i=new Set(s);return[t.columnNames().map(o=>{const u=`[${J(o)}]`;return i.has(o)?{[o]:`(a, b) => a${u} == null ? b${u} : a${u}`}:o}),a]}return r.right?[a,ut()]:[ut(),a]}function Va(t,e,n,r,s=[]){if(D(n)){let a,i,o,u=n.length;a=i=o={names:[],exprs:[]},u--&&(a=G("join",t,n[0],r)),u--&&(i=G("join",e,n[1],qa)),u--&&(o=z(n[2],r));const l=new Set,c=new Set(a.names);return i.names.forEach(d=>{c.has(d)&&l.add(d)}),l.size&&(s[0]!==""&&Xn(a.names,l,s[0]||"_1"),s[1]!==""&&Xn(i.names,l,s[1]||"_2")),{names:a.names.concat(i.names,o.names),exprs:a.exprs.concat(i.exprs,o.exprs)}}else return z(n,r)}function Xn(t,e,n){t.forEach((r,s)=>e.has(r)?t[s]=r+n:0)}function Ja(t,e){const n=["i","a","j","b"];return dt(n,"{"+vt(t,(r,s)=>`_${s}.push($${s}(${n}));`)+"}",t,e)}function Ga(t,e,n,{names:r,exprs:s},a={}){const i=t.data(),o=t.indices(!1),u=o.length,l=new Int32Array(u),c=e.data(),d=e.indices(!1),f=d.length,m=new Int32Array(f),h=r.length,p=I(),g=Array(h),$=Array(h);for(let y=0;y<r.length;++y)g[y]=p.add(r[y],[]),$[y]=s[y];const x=Ja(g,$);if((D(n)?Wa:Ha)(x,n,i,c,o,d,l,m,u,f),a.left)for(let y=0;y<u;++y)l[y]||x(o[y],i,Zn,c);if(a.right)for(let y=0;y<f;++y)m[y]||x(Zn,i,d[y],c);return p.new(t)}function Ha(t,e,n,r,s,a,i,o,u,l){for(let c=0;c<u;++c){const d=s[c];for(let f=0;f<l;++f){const m=a[f];e(d,n,m,r)&&(t(d,n,m,r),i[c]=1,o[f]=1)}}}function Wa(t,[e,n],r,s,a,i,o,u,l,c){let d,f,m,h,p,g,$,x,y=t;l>=c?(d=r,f=e,m=o,h=a,p=s,g=n,$=u,x=i):(d=s,f=n,m=u,h=i,p=r,g=e,$=o,x=a,y=(b,P,k,q)=>t(k,q,b,P));const E=ja(x,p,g),F=h.length;for(let b=0;b<F;++b){const P=h[b],k=E.get(f(P,d));if(k){const q=k.length;for(let H=0;H<q;++H){const it=k[H];y(P,d,x[it],p),$[it]=1}m[b]=1}}}function Ba(t,e,n,...r){return n=je(t,e,n),r=r.length===0?[ye(t.columnNames())]:r.flat(),Ya(t,e,[Ht("lookup",t,n[0]),Ht("lookup",e,n[1])],G("lookup",e,r))}function Ya(t,e,[n,r],{names:s,exprs:a,ops:i=[]}){const o=I(t),u=t.totalRows();s.forEach(f=>o.add(f,Array(u).fill(w)));const l=Vn(e,r),c=dt(["lr","rr","data"],"{"+vt(s,(f,m)=>`_[${m}][lr] = $[${m}](rr, data);`)+"}",s.map(f=>o.data[f]),ot(e,i,a)),d=e.data();return t.scan((f,m)=>{const h=l.get(n(f,m));h>=0&&c(f,h,d)}),o.derive(t)}const Qa=(t,e,n,r)=>`((u = ${t}) < (v = ${e}) || u == null) && v != null ? ${n} : (u > v || v == null) && u != null ? ${r} : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n} : v !== v && u === u ? ${r} : `,Za=(t,e,n,r,s)=>`(v = ${e}, (u = ${t}) == null && v == null) ? 0 : v == null ? ${r} : u == null ? ${n} : (u = ${s}(u,v)) ? u : `;function Xa(t,e){const n=[],r=[],s=[];let a=null,i="0",o="0";t.isGrouped()&&(a=t.groups().keys,i="ka",o="kb");const{ops:u}=z(e,{table:t,value:(m,h)=>{if(n.push(m),h.escape){const p=g=>`fn[${s.length}](${g}, data)`;r.push([p("a"),p("b")]),s.push(h.escape)}else r.push([qt(h,{index:"a",op:i}),qt(h,{index:"b",op:o})])},window:!1}),l=ht(t,u),c=(m,h)=>l[m][h],d=n.length;let f="return (a, b) => {"+(c&&t.isGrouped()?"const ka = keys[a], kb = keys[b];":"")+"let u, v; return ";for(let m=0;m<d;++m){const h=e.get(n[m]),p=h.desc?-1:1,[g,$]=r[m];h.collate?(f+=Za(g,$,-p,p,`${p<0?"-":""}fn[${s.length}]`),s.push(h.collate)):f+=Qa(g,$,-p,p)}return f+="0;};",Function("op","keys","fn","data",f)(c,a,s,t.data())}function Ka(t,...e){return ei(t,ti(t,e.flat()))}function ti(t,e){let n=-1;const r=new Map,s=a=>r.set(++n+"",a);return e.forEach(a=>{const i=a.expr!=null?a.expr:a;if(tt(i)&&!T(i))for(const o in i)s(i[o]);else s(Z(i)?bt(a,t.columnName(i)):R(i)?bt(a):T(i)?a:M(`Invalid orderby field: ${a+""}`))}),Xa(t,r)}function ei(t,e){return t.create({order:e})}function ni(t,e,n,r){return si(t,G("fold",t,e),G("fold",t,n,{preparse:ri,window:!1,aggronly:!0}),r)}function ri(t){t.forEach((e,n)=>e.field?t.set(n,Pe(e+"")):0)}const ke=(t,e)=>t??e;function si(t,e,n,r={}){const{keys:s,keyColumn:a}=ai(t,e,r),i=ke(r.valueSeparator,"_"),o=n.names.length>1?(l,c)=>c+i+s[l]:l=>s[l],u=s.map(l=>ht(t,n.ops.map(c=>{if(c.name==="count"){const f=m=>l===a[m]?1:NaN;return f.toString=()=>l+":1",{...c,name:"sum",fields:[f]}}const d=c.fields.map(f=>{const m=(h,p)=>l===a[h]?f(h,p):NaN;return m.toString=()=>l+":"+f,m});return{...c,fields:d}})));return ii(n,o,t.groups(),u).new(t)}function ai(t,e,n){const r=n.limit>0?+n.limit:1/0,s=ke(n.sort,!0),a=ke(n.keySeparator,"_"),i=ot(t,e.ops,e.exprs),o=i.length===1?i[0]:(d,f)=>i.map(m=>m(d,f)).join(a),u=Array(t.totalRows());t.scan((d,f)=>u[d]=o(d,f));const l=ht(Wt(t),[{id:0,name:"array_agg_distinct",fields:[d=>u[d]],params:[]}])[0][0],c=s?l.sort():l;return{keys:Number.isFinite(r)?c.slice(0,r):c,keyColumn:u}}function ii({names:t,exprs:e},n,r,s){const a=r?r.size:1,i=I(),o=s.length,u=t.length;let l;const c=(d,f)=>l[d][f];r&&sn(i,r);for(let d=0;d<u;++d){const f=e[d];if(f.field!=null)for(let m=0;m<o;++m)i.add(n(m,t[d]),s[m][f.field]);else if(a>1)for(let m=0;m<o;++m){l=s[m];const h=i.add(n(m,t[d]),Array(a));for(let p=0;p<a;++p)h[p]=f(p,null,c)}else for(let m=0;m<o;++m)l=s[m],i.add(n(m,t[d]),[f(0,null,c)])}return i}function oi(t,e){const n=I(),r=t.groups(),{get:s,names:a=[],rows:i,size:o=1}=r||{},u=new Uint32Array(o+1);a.forEach(f=>n.add(f,null));const l=r?rn(t,e,r):[nn(t,e)];e.outputs().map(f=>n.add(f,[]));const c=u.length-1;let d=0;for(let f=0;f<c;++f)d+=u[f+1]=e.write(l[f],n.data,u[f]);if(r){const f=t.data();a.forEach((m,h)=>{const p=n.data[m]=Array(d),g=s[h];for(let $=0,x=0;$<o;++$)p.fill(g(i[$],f),x,x+=u[$+1])})}return n.new(t)}function ui(t,...e){const n=new Map;return t.columnNames(r=>(n.set(r,r),0)),be(t,X(t,e.flat(),n))}function li(t,e,n,r){return(e?r?fi:ci:r?mi:di)(t.length,t,n,r)}function ci(t,e,n){const r=n.length;for(let s=0;s<t;++s)e[s]=n[r*ct()|0];return e}function fi(t,e,n,r){const s=n.length,a=new Float64Array(s);let i=0;for(let u=0;u<s;++u)a[u]=i+=r(n[u]);const o=Pn(re).right;for(let u=0;u<t;++u)e[u]=n[o(a,i*ct())];return e}function di(t,e,n){const r=n.length;if(t>=r)return n;for(let s=0;s<t;++s)e[s]=n[s];for(let s=t;s<r;++s){const a=s*ct();a<t&&(e[a|0]=n[s])}return e}function mi(t,e,n,r){const s=n.length;if(t>=s)return n;const a=new Float32Array(s),i=new Uint32Array(s);for(let o=0;o<s;++o)i[o]=o,a[o]=-Math.log(ct())/r(n[o]);i.sort((o,u)=>a[o]-a[u]);for(let o=0;o<t;++o)e[o]=n[i[o]];return e}function hi(t,e=0,n=t.length){let r=n-(e=+e);for(;r;){const s=ct()*r--|0,a=t[r+e];t[r+e]=t[s+e],t[s+e]=a}return t}function pi(t,e,n={}){return vi(t,gi(t,e),$i(t,n.weight),n)}const Kn=t=>e=>t.at(e)||0;function gi(t,e){return Z(e)?()=>e:Kn(xe(t,z({size:e},{table:t,window:!1})).column("size"))}function $i(t,e){return e==null?null:(e=Z(e)?t.columnName(e):e,Kn(R(e)?t.column(e):Me(t,z({w:e},{table:t}),{drop:!0}).column("w")))}function vi(t,e,n,r={}){const{replace:s,shuffle:a}=r,i=t.partitions(!1);let o=0;e=i.map((c,d)=>{let f=e(d);return o+=f=s?f:Math.min(c.length,f),f});const u=new Uint32Array(o);let l=0;return i.forEach((c,d)=>{const f=e[d],m=u.subarray(l,l+=f);!s&&f===c.length?m.set(c):li(m,s,c,n)}),a!==!1&&(i.length>1||!s)&&hi(u),t.reify(u)}function yi(t=0,e=1/0){return`${tr(t)} < row_number() && row_number() <= ${tr(e)}`}function tr(t){return t<0?`count() + ${t}`:t}function _i(t,e=0,n=1/0){if(t.isGrouped())return Ee(t,yi(e,n)).reify();const r=[],s=t.numRows();return e=Math.max(0,e+(e<0?s:0)),n=Math.min(s,Math.max(0,n+(n<0?s:0))),t.scan(a=>r.push(a),!0,n-e,e),t.reify(r)}function wi(t,e,n){return xi(t,G("spread",t,e),n)}function xi(t,{names:e,exprs:n,ops:r=[]},s={}){if(e.length===0)return t;const a=e.length===1&&s.as||[],i=s.drop==null?!0:!!s.drop,o=s.limit==null?a.length||1/0:Math.max(1,+s.limit||1),u=ot(t,r,n),l=I(),c=e.reduce((f,m,h)=>f.set(m,h),new Map),d=(f,m)=>{const h=bi(t,u[f],o),p=h.length;for(let g=0;g<p;++g)l.add(a[g]||`${m}_${g+1}`,h[g])};return t.columnNames().forEach(f=>{c.has(f)?(i||l.add(f,t.column(f)),d(c.get(f),f),c.delete(f)):l.add(f,t.column(f))}),c.forEach(d),l.derive(t)}function bi(t,e,n){const r=t.totalRows(),s=[];return t.scan((a,i)=>{const o=B(e(a,i)),u=Math.min(o.length,n);for(;s.length<u;)s.push(Array(r).fill(w));for(let l=0;l<u;++l)s[l][a]=o[l]}),s}function Mi(t,...e){return Gt(In(t,e.flat()))}function Ei(t){return t.isOrdered()?t.create({order:null}):t}function ji(t){return t.getUTCHours()===0&&t.getUTCMinutes()===0&&t.getUTCSeconds()===0&&t.getUTCMilliseconds()===0}function ki(t,e={}){let n=0,r=0,s=0,a=0,i=0,o=0;return t(u=>{if(++n,u==null){++r;return}const l=typeof u;if(l==="object"&&nt(u))++s,ji(u)&&++a;else if(l==="number"&&(++i,u===u&&(u|0)!==u)){const c=u+"",d=c.indexOf(".");if(d>=0){const f=c.indexOf("e"),m=f>0?f:c.length;o=Math.max(o,m-d-1)}}}),{align:(r+i+s)/n>.5?"r":"l",format:{utc:s===a,digits:Math.min(o,e.maxdigits||6)}}}var jt=t=>t;function kt(t,e){return T(e)?e(t):e||t.columnNames()}function er(t,e,n){const r=n.format||{},s=n.align||{},a={},i={};return e.forEach(o=>{const u=ki(Ai(t,o),n);i[o]=s[o]||u.align,a[o]=r[o]||u.format}),{align:i,format:a}}function Ai(t,e){const n=t.column(e);return r=>t.scan(s=>r(n.at(s)))}function Ae(t,e,n=100,r,s){const{start:a=jt,cell:i,end:o=jt}=s,u=t.data(),l=e.length;t.scan(c=>{a(c);for(let d=0;d<l;++d){const f=e[d];i(u[f].at(c),f,d)}o(c)},!0,n,r)}function Ne(t,e={}){const{columns:n,limit:r=1/0,offset:s=0,types:a={},...i}=e,o=kt(t,n),u=t.data(),l=s===0&&t.numRows()<=r&&!t.isFiltered()&&!t.isOrdered();return xr(o.map(c=>{const d=u[c],f=a[c],m=K(d);let h;if(l&&(m||T(d.toArray)))h=br(m?d:d.toArray(),f,i);else{const p=m?g=>d[g]:g=>d.at(g);h=Mr(g=>t.scan($=>g(p($)),!0,r,s),f,i)}return[c,h]}))}function nr(t,e={}){const{format:n="stream",...r}=e;return Er(Ne(t,r),{format:n})}function rr(t,e={}){const n=kt(t,e.columns),r=e.format||{},s=e.delimiter||",",a=e.header??!0,i=new RegExp(`["${s}
\r]`),o=c=>c==null?"":nt(c)?Ct(c,!0):i.test(c+="")?'"'+c.replace(/"/g,'""')+'"':c,u=n.map(o);let l=a?u.join(s)+`
`:"";return Ae(t,n,e.limit||1/0,e.offset,{cell(c,d,f){u[f]=o(r[d]?r[d](c):c)},end(){l+=u.join(s)+`
`}}),l}function sr(t,e={}){if(T(e))return e(t)+"";const n=typeof t;if(n==="object"){if(nt(t))return e.utc?Ct(t):Te(t);{const r=JSON.stringify(t,(a,i)=>St(i)?Array.from(i):i),s=e.maxlen||30;return r.length>s?r.slice(0,28)+"\u2026"+(r[0]==="["?"]":"}"):r}}else if(n==="number"){const r=e.digits||0;let s;return t!==0&&((s=Math.abs(t))>=1e18||s<Math.pow(10,-r))?t.toExponential(r):t.toFixed(r)}else return t+""}function Ni(t,e,n={}){for(const r in t)n[r]=e(t[r],r);return n}function ar(t,e={}){const n=kt(t,e.columns),{align:r,format:s}=er(t,n,e),a=Si(e),i=e.null,o=p=>p==="c"?"center":p==="r"?"right":"left",u=p=>p.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),l=(p,g)=>u(sr(p,g)),c=i?(p,g)=>p==null?i(p):l(p,g):l;let d=-1,f=-1;const m=(p,g,$)=>{const x=$?o(r[g]):"",y=a[p]&&a[p](g,f,d)||"",E=(x?`text-align: ${x};`+(y?" ":""):"")+y;return`<${p}${E?` style="${E}"`:""}>`};let h=m("table")+m("thead")+m("tr",d)+n.map(p=>`${m("th",p,1)}${p}</th>`).join("")+"</tr></thead>"+m("tbody");return Ae(t,n,e.limit,e.offset,{start(p){d=p,++f,h+=m("tr")},cell(p,g){h+=m("td",g,1)+c(p,s[g])+"</td>"},end(){h+="</tr>"}}),h+"</tbody></table>"}function Si(t){return Ni(t.style,e=>T(e)?e:()=>e)}function ir(t,e=!0,n=!1){return t===void 0||t?e:n}const Oi=t=>nt(t)?Ct(t,!0):t;function or(t,e={}){const n=ir(e.schema),r=e.format||{},s=kt(t,e.columns);let a="{";return n&&(a+='"schema":{"fields":'+JSON.stringify(s.map(i=>({name:i})))+'},"data":{'),s.forEach((i,o)=>{a+=(o?",":"")+JSON.stringify(i)+":[";const u=t.column(i),l=r[i]||Oi;let c=-1;t.scan(d=>{const f=u.at(d);a+=(++c?",":"")+JSON.stringify(l(f))},!0,e.limit,e.offset),a+="]"}),a+"}"+(n?"}":"")}function ur(t,e={}){const n=kt(t,e.columns),{align:r,format:s}=er(t,n,e),a=u=>u==="c"?":-:":u==="r"?"-:":":-",i=u=>u.replace(/\|/g,"\\|");let o="|"+n.map(i).join("|")+`|
|`+n.map(u=>a(r[u])).join("|")+`|
`;return Ae(t,n,e.limit,e.offset,{start(){o+="|"},cell(u,l){o+=i(sr(u,s[l]))+"|"},end(){o+=`
`}}),o}class lt extends Jt{assign(...e){return ma(this,...e)}count(e={}){const{as:n="count"}=e;return Mt(this,{[n]:Le()})}derive(e,n){return xa(this,e,n)}filter(e){return Ee(this,e)}slice(e,n){return _i(this,e,n)}groupby(...e){return we(this,...e)}orderby(...e){return Ka(this,...e)}relocate(e,n){return qn(this,B(e),n)}rename(...e){return ui(this,...e)}reduce(e){return oi(this,e)}rollup(e){return Mt(this,e)}sample(e,n){return pi(this,e,n)}select(...e){return Rn(this,...e)}ungroup(){return Wt(this)}unorder(){return Ei(this)}dedupe(...e){return Gt(this,...e)}impute(e,n){return Ua(this,e,n)}fold(e,n){return Fa(this,e,n)}pivot(e,n,r){return ni(this,e,n,r)}spread(e,n){return wi(this,e,n)}unroll(e,n){return Ca(this,e,n)}lookup(e,n,...r){return Ba(this,e,n,...r)}join(e,n,r,s){return Et(this,e,n,r,s)}join_left(e,n,r,s){const a={...s,left:!0,right:!1};return Et(this,e,n,r,a)}join_right(e,n,r,s){const a={...s,left:!1,right:!0};return Et(this,e,n,r,a)}join_full(e,n,r,s){const a={...s,left:!0,right:!0};return Et(this,e,n,r,a)}cross(e,n,r){return Pa(this,e,n,r)}semijoin(e,n){return Gn(this,e,n)}antijoin(e,n){return Hn(this,e,n)}concat(...e){return In(this,...e)}union(...e){return Mi(this,...e)}intersect(...e){return za(this,...e)}except(...e){return Oa(this,...e)}toArrow(e){return Ne(this,e)}toArrowIPC(e){return nr(this,e)}toCSV(e){return rr(this,e)}toHTML(e){return ar(this,e)}toJSON(e){return or(this,e)}toMarkdown(e){return ur(this,e)}}function lr(t,e){const{columns:n=ut(),...r}=e||{},s=t instanceof ArrayBuffer||t instanceof Uint8Array?jr(t,{useDate:!0,...r}):t,{fields:a}=s.schema,i=a.map(l=>l.name),o=X({columnNames:l=>l?i.filter(l):i.slice(),columnIndex:l=>i.indexOf(l)},n),u=I();return o.forEach((l,c)=>{const d=s.getChild(c);u.add(l,d.type.typeId===-1?Ci(d):d)}),new lt(u.data,u.names)}function Ci(t){const{data:e,length:n,nullCount:r}=t,s=e[e.length-1],a=s.cache??s.dictionary.toArray(),i=a.length,o=Fi(e,n,r,i),u=r?l=>l===i?null:a[l]:l=>a[l];return{length:n,nullCount:r,at:l=>u(o[l]),key:l=>o[l],keyFor(l){if(l===null)return r?i:-1;for(let c=0;c<i;++c)if(a[c]===l)return c;return-1},groups(l){const c=i+(r?1:0);return{keys:o,get:[u],names:l,rows:qe(0,c),size:c}},[Symbol.iterator]:()=>t[Symbol.iterator](),toArray:()=>t.toArray()}}function Fi(t,e,n,r){const s=t.length>1||n?Ti(t,e):t[0].values;return n?Ui(t,s,r):s}function Ti(t,e){const n=t[0].values.constructor,r=new n(e),s=t.length;for(let a=0,i=0,o;a<s;++a)o=t[a].length,r.set(t[a].values.subarray(0,o),i),i+=o;return r}function Ui(t,e,n){const r=t.length;for(let s=0,a=0,i;s<r;++s){const o=t[s],{length:u}=o,l=o.validity??o.nullBitmap,c=u>>3;if(l&&l.length){for(let d=0;d<=c;++d)if((i=l[d])!==255){const f=a+(d<<3);i&1||(e[f+0]=n),i&2||(e[f+1]=n),i&4||(e[f+2]=n),i&8||(e[f+3]=n),i&16||(e[f+4]=n),i&32||(e[f+5]=n),i&64||(e[f+6]=n),i&128||(e[f+7]=n)}}a+=u}return e}const Di=[t=>t==="true"||t==="false",t=>t!=="false"],cr=[t=>t==="NaN"||(t=+t)===t,t=>+t],Ri=[Yt,t=>new Date(Date.parse(t))];function zi(t){const{decimal:e}=t;return e&&e!=="."?cr.map(n=>r=>n(r&&r.replace(e,"."))):cr}function Ii(t,e){const n=[Di,zi(e),Ri],r=n.length;for(let s=0;s<r;++s){const[a,i]=n[s];if(qi(t,a))return i}return jt}function qi(t,e){const n=t.length;for(let r=0;r<n;++r){const s=t[r];if(s!=null&&!e(s))return!1}return!0}function fr(t,e=0){return mt(t-e,n=>`col${n+e+1}`)}function dr(t,e,n){let r=t();const s=r.length,a=+n.autoMax||1e3,i=mt(s,()=>[]);e=e?e.length<s?[...e,fr(s,e.length)]:e:fr(s);let o=0;for(;o<a&&r;++o,r=t())for(let c=0;c<s;++c)i[c].push(r[c]===""?null:r[c]);const u=Pi(e,i,n);for(u.forEach((c,d)=>{if(c===jt)return;const f=i[d];for(let m=0;m<o;++m)f[m]!=null&&(f[m]=c(f[m]))});r;r=t())for(let c=0;c<s;++c)i[c].push(r[c]?u[c](r[c]):null);const l={};return e.forEach((c,d)=>l[c]=i[d]),new lt(l,e)}function Pi(t,e,n){const{parse:r={}}=n,s=n.autoType===!1;return t.map((a,i)=>T(r[a])?r[a]:s?jt:Ii(e[i],n))}const mr={},Se={},Oe=34,at=10,At=13;function hr(t,e,n){let r=+e||0;for(;--r>=0;)t();return n?()=>{let s;for(;!s;)if(n(s=t()))s=null;else return s}:t}function Li(t,{delimiter:e=",",skip:n=0,comment:r=void 0}){e.length!==1&&M(`Text "delimiter" should be a single character, found "${e}"`);const s=e.charCodeAt(0);let a=t.length,i=0,o,u=a<=0,l=!1;t.charCodeAt(a-1)===at&&--a,t.charCodeAt(a-1)===At&&--a;function c(){if(u)return Se;if(l)return l=!1,mr;const f=i;let m,h;if(t.charCodeAt(f)===Oe){for(;i++<a&&t.charCodeAt(i)!==Oe||t.charCodeAt(++i)===Oe;);return(m=i)>=a?u=!0:(h=t.charCodeAt(i++))===at?l=!0:h===At&&(l=!0,t.charCodeAt(i)===at&&++i),t.slice(f+1,m-1).replace(/""/g,'"')}for(;i<a;){if((h=t.charCodeAt(m=i++))===at)l=!0;else if(h===At)l=!0,t.charCodeAt(i)===at&&++i;else if(h!==s)continue;return t.slice(f,m)}return u=!0,t.slice(f,a)}function d(){if((o=c())!==Se){const f=[];for(;o!==mr&&o!==Se;)f.push(o),o=c();return f}}return hr(d,n,r&&(f=>(f&&f[0]||"").startsWith(r)))}function Ce(t,e={}){const n=Li(t,e);return dr(n,e.header!==!1?n():e.names,e)}function Vi(t,{skip:e=0,comment:n=void 0}){let r=t.length,s=0;t.charCodeAt(r-1)===at&&--r,t.charCodeAt(r-1)===At&&--r;function a(){if(s>=r)return;const i=s;let o=!1,u,l;for(;s<r;)if((l=t.charCodeAt(u=s++))===at?o=!0:l===At&&(o=!0,t.charCodeAt(s)===at&&++s),o)return t.slice(i,u);return t.slice(i,r)}return hr(a,e,n&&(i=>(i||"").startsWith(n)))}function pr(t,e={}){const n=Vi(t,e),r=Ji(e);return dr(()=>{const s=n();if(s)return r.map(([a,i])=>s.slice(a,i).trim())},e.names,e)}function Ji({positions:t=void 0,widths:e=void 0}){!t&&!e&&M('Fixed width files require a "positions" or "widths" option');let n=0;return t||e.map(r=>[n,n+=r])}function Gi(t){const e=t.length;for(let n=0;n<e;++n){const r=t.charCodeAt(n);if(r<48||r>57)return!1}return!0}function gr(t,e={}){const n=ir(e.autoType);R(t)&&(t=JSON.parse(t));let r=t.data,s;if(tt(r)&&!K(r)?t.schema&&t.schema.fields&&(s=t.schema.fields.map(a=>a.name)):r=t,n||e.parse){const a=e.parse||{};for(const i in r){const o=r[i],u=o.length;if(a[i])for(let l=0;l<u;++l)o[l]=a[i](o[l]);else if(n)for(let l=0;l<u;++l){const c=o[l];R(c)&&Yt(c)&&!Gi(c)&&(o[l]=new Date(c))}}}return new lt(r,s)}function Hi(t,e={}){const n=`d[${JSON.stringify(t)}]`,{maxbins:r,nice:s,minstep:a,step:i,offset:o}=e,u=[r,s,a,i];let l=u.length;for(;l&&u[--l]==null;)u.pop();const c=u.length?", "+u.map(d=>d+"").join(", "):"";return`d => op.bin(${n}, ...op.bins(${n}${c}), ${o||0})`}function Wi(t){return xt(t,{escape:!0,toString(){M("Escaped values can not be serialized.")}})}function Bi(t,e,n){return xt(t,{collate:T(e)?e:new Intl.Collator(e,n).compare})}function Yi(t){return xt(t,{desc:!0})}function Qi(t){return`() => op.round(${+t} * op.count())`}function Zi(...t){return t=t.flat(),e=>{const n=new Map,r=Math.min(t.length,e.numCols());for(let s=0;s<r;++s)n.set(e.columnName(s),t[s]);return n}}function Xi(t,e,n){return xt(t,{window:{frame:e||[-1/0,0],peers:!!n}})}function Ki(t,e){return Mt(Wt(t),{_:e}).get("_")}const to=(t,e)=>M(`Illegal ${e} name: ${J(t)}`),eo=(t,e)=>M(`The ${e} ${J(t)} is already defined. Use override option?`),no=(t,e)=>M(`The ${e} name ${J(t)} is reserved and can not be overridden.`);function ro(t,e,n=Ut,r="function"){t||to(t,r),!e.override&&V(n,t)&&eo(t,r)}function $r(t,e,n,r){return n[t]===e||ro(t,r)}function vr(t,e,n,r={}){if($r(t,e,n,r))return;const[s=0,a=0]=e.param;n[t]=e,Ut[t]=(...i)=>v(t,i.slice(0,s),i.slice(s,s+a))}function so(t,e,n){vr(t,e,Kt,n)}function ao(t,e,n){vr(t,e,te,n)}function io(t,e,n={}){arguments.length===1&&(e=t,t=e.name,t===""||t==="anonymous"?M("Anonymous function provided, please include a name argument."):t===Lt&&no(Lt,"function")),!$r(t,e,rt,n)&&(rt[t]=e,Ut[t]=e)}function oo(t,e){const n=r=>M(`Illegal argument type: ${r||typeof t}`);return t instanceof Map?yr(t.entries(),e):nt(t)?n("Date"):Ft(t)?n("RegExp"):R(t)?n():D(t)?uo(t,e):T(t[Symbol.iterator])?lo(t,e):tt(t)?yr(Object.entries(t),e):n()}function yr(t,e=["key","value"]){const n=[],r=[];for(const[a,i]of t)n.push(a),r.push(i);const s={};return e[0]&&(s[e[0]]=n),e[1]&&(s[e[1]]=r),s}function uo(t,e){const n=t.length,r={},s=a=>r[a]=Array(n);if(n){e=e||Object.keys(t[0]);const a=e.map(s),i=a.length;for(let o=0;o<n;++o){const u=t[o];for(let l=0;l<i;++l)a[l][o]=u[e[l]]}}else e&&e.forEach(s);return r}function lo(t,e){const n={},r=i=>n[i]=[];let s,a;for(const i of t){s||(e=e||Object.keys(i),s=e.map(r),a=s.length);for(let o=0;o<a;++o)s[o].push(i[e[o]])}return!s&&e&&e.forEach(r),n}function co(t,e){if(t instanceof lt)return t;const n={},r=[];for(const[s,a]of Pt(t))n[s]=a,r.push(s);return new lt(n,e||r)}function _r(t,e){return new lt(oo(t,e),e)}function Nt(t,e={}){const n=e.using||Ce;return fetch(t,e.fetch).then(r=>r[e.as||"text"]()).then(r=>n(r,e))}function fo(t,e){return Nt(t,{...e,as:"arrayBuffer",using:lr})}function mo(t,e){return Nt(t,{...e,as:"text",using:Ce})}function ho(t,e){return Nt(t,{...e,as:"text",using:pr})}function po(t,e){return Nt(t,{...e,as:"json",using:go})}function go(t,e){return D(t)?_r(t):gr(t,e)}export{Bt as BitSet,lt as ColumnTable,Be as Reducer,Jt as Table,so as addAggregateFunction,io as addFunction,ao as addWindowFunction,Ki as agg,ut as all,Hi as bin,Bi as collate,Yi as desc,aa as endswith,Wi as escape,bt as field,Qi as frac,_r as from,lr as fromArrow,Ce as fromCSV,pr as fromFixed,gr as fromJSON,Nt as load,fo as loadArrow,mo as loadCSV,ho as loadFixed,po as loadJSON,_e as matches,Zi as names,ye as not,Ut as op,z as parse,ra as range,Xi as rolling,Lr as seed,sa as startswith,co as table,Ne as toArrow,nr as toArrowIPC,rr as toCSV,ar as toHTML,or as toJSON,ur as toMarkdown,_ as walk_ast};
